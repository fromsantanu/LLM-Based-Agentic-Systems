# **Chapter 19: Packaging & Reuse**

### üéØ **Goal**

Make your reusable layers (like `models/`, `services/`, or `repositories/`) available as installable packages so multiple apps can share them.

---

## üß± **Concept: Why Package Your Code?**

When your system grows, you often need to reuse core logic ‚Äî
for example:

* `models/` containing DTOs and schemas
* `services/` containing business rules
* `repositories/` with database logic

Instead of copying folders between projects, package them into a **Python distributable**.

This way, you can:

* Install them with `pip install .`
* Version them (e.g., `health_core==0.1.0`)
* Reuse across multiple Dash/Streamlit or FastAPI apps

---

## üóÇÔ∏è **Example Project Structure**

Suppose your main project has:

```
health_core/
    __init__.py
    models/
        __init__.py
        patient_dto.py
    services/
        __init__.py
        patient_service.py
    repositories/
        __init__.py
        patient_repo.py
pyproject.toml
README.md
```

Another app (like a dashboard) can later import:

```python
from health_core.services.patient_service import list_patients
```

---

## ‚öôÔ∏è **Step 1: Add a `pyproject.toml`**

The new Python packaging standard uses this file.

```toml
[build-system]
requires = ["setuptools", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "health_core"
version = "0.1.0"
description = "Core models and services for healthcare apps"
authors = [{ name="Desmond Williamson", email="example@email.com" }]
readme = "README.md"
requires-python = ">=3.9"

[project.optional-dependencies]
dev = ["pytest", "black", "mypy"]

[tool.setuptools.packages.find]
where = ["."]
```

---

## ‚öôÔ∏è **Step 2: Make Folders Recognizable as Packages**

Each folder that contains reusable code needs an `__init__.py` file (even if empty):

```
models/__init__.py
services/__init__.py
repositories/__init__.py
```

---

## üß© **Step 3: Build & Install Locally**

Run:

```bash
pip install -e .
```

`-e` means "editable" ‚Äî changes in your source will reflect instantly.

Now you can import your modules anywhere on your system.

Example:

```python
from health_core.models.patient_dto import PatientCreate
```

---

## üß™ **Step 4: Reuse in Another App**

In another Streamlit/Dash app, modify its structure:

```
dash_app/
    app.py
    controllers/
    views/
```

Install your package:

```bash
pip install -e ../health_core
```

Then import shared logic:

```python
from health_core.services.patient_service import get_patient_summary
```

---

## üß∞ **Step 5: Versioning and Distribution (Optional)**

To share it with teammates:

1. Build a distribution:

   ```bash
   python -m build
   ```
2. Upload to PyPI or internal index:

   ```bash
   twine upload dist/*
   ```
3. Others can install with:

   ```bash
   pip install health_core
   ```

---

## üß† **Concept: Modularization Benefits**

| Benefit             | Description                                    |
| ------------------- | ---------------------------------------------- |
| **Code Reuse**      | Share business logic across apps               |
| **Maintainability** | Update once, reflect everywhere                |
| **Version Control** | Manage versions cleanly (`health_core==0.2.0`) |
| **Cleaner Imports** | `from health_core import models, services`     |

---

## üß™ **Lab: Build a Reusable Package**

### üéØ **Objective**

Package your service and reuse it in another mini app.

---

### üß© **Tasks**

1. **Create a folder:**

   ```
   health_core/
       models/
           __init__.py
           patient_dto.py
       services/
           __init__.py
           patient_service.py
   ```

2. **Write a simple model:**

   ```python
   # models/patient_dto.py
   from pydantic import BaseModel

   class Patient(BaseModel):
       id: int
       name: str
       age: int
   ```

3. **Write a service using it:**

   ```python
   # services/patient_service.py
   from health_core.models.patient_dto import Patient

   def list_patients():
       return [
           Patient(id=1, name="Alice", age=30),
           Patient(id=2, name="Bob", age=42)
       ]
   ```

4. **Add `pyproject.toml`** (as shown above)

5. **Install it locally:**

   ```bash
   pip install -e .
   ```

6. **Create another app (e.g., `streamlit_app/app.py`):**

   ```python
   import streamlit as st
   from health_core.services.patient_service import list_patients

   st.title("Patient Directory")
   for p in list_patients():
       st.write(f"{p.name} ({p.age} years)")
   ```

7. **Run the app:**

   ```bash
   streamlit run app.py
   ```

‚úÖ You have successfully **packaged** and **reused** your business logic across multiple apps.

---

### üí° **Best Practices**

* Keep shared packages **framework-agnostic** (no Dash/Streamlit imports).
* Group related functionality (e.g., `health_core.analytics`, `health_core.billing`).
* Use **semantic versioning** (`MAJOR.MINOR.PATCH`).
* Automate packaging in CI/CD (optional for large projects).

---
