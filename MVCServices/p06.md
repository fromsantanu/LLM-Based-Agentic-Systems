## **Chapter 6: Config & Environments**

### üéØ **Goal**

Create **reproducible setups** for **development**, **testing**, and **production** environments ‚Äî ensuring consistent behavior across stages of deployment.

---

### üß† **Learn**

#### 1. Why Configurations Matter

When your app runs locally, you may use:

* a **SQLite** DB
* **debug=True**
* extra logging

But in production:

* you‚Äôll use **PostgreSQL or MySQL**
* **debug=False**
* strict **security and performance** flags

To manage these differences, we need **config files** and **environment variables**.

---

#### 2. `.env` File

A `.env` file stores key-value pairs for configuration:

```bash
# .env
ENVIRONMENT=development
DB_URL=sqlite:///./app.db
DEBUG=True
FEATURE_LOGIN=True
```

This file is **not committed** to Git (add `.env` to `.gitignore`) because it often contains secrets or machine-specific settings.

---

#### 3. Using `pydantic-settings`

`pydantic-settings` (formerly `pydantic.BaseSettings`) helps load env variables safely and validate them automatically.

Install:

```bash
pip install pydantic-settings
```

---

#### 4. Configuration Objects

We‚Äôll build a `Settings` class that automatically reads `.env` and applies type checking.

Example:

```python
# app/config/settings.py
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    environment: str = "development"
    db_url: str
    debug: bool = False
    feature_login: bool = True

    model_config = SettingsConfigDict(env_file=".env")

settings = Settings()
```

Now you can access configuration anywhere:

```python
from app.config.settings import settings

print(settings.db_url)
print(settings.environment)
```

---

### üß© **5. Multiple Environments**

You can define **separate env files** for each stage:

```
.env.development
.env.testing
.env.production
```

Then, in your code:

```python
import os
from pydantic_settings import BaseSettings, SettingsConfigDict

ENV = os.getenv("ENVIRONMENT", "development")

class Settings(BaseSettings):
    db_url: str
    debug: bool
    feature_login: bool = True

    model_config = SettingsConfigDict(env_file=f".env.{ENV}")

settings = Settings()
```

Now the environment auto-selects the correct file.

---

### ‚öôÔ∏è **6. Integration with FastAPI**

Use the settings in your `main.py`:

```python
# app/main.py
from fastapi import FastAPI
from app.config.settings import settings

app = FastAPI(debug=settings.debug)

@app.get("/info")
def info():
    return {
        "environment": settings.environment,
        "database": settings.db_url,
        "debug": settings.debug,
    }
```

---

### üß™ **Lab Exercise**

#### üß≠ Task

Build `config/settings.py` with:

* DB URL
* feature flags (`ENABLE_CACHE`, `ENABLE_ANALYTICS`)
* environment switching logic

#### ‚úÖ Example Solution

```python
# app/config/settings.py
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    environment: str = "development"
    db_url: str = "sqlite:///./test.db"
    enable_cache: bool = False
    enable_analytics: bool = False

    model_config = SettingsConfigDict(env_file=".env")

settings = Settings()
```

#### ‚úÖ .env file

```bash
ENVIRONMENT=development
DB_URL=sqlite:///./sales.db
ENABLE_CACHE=True
ENABLE_ANALYTICS=False
```

#### ‚úÖ Test Script

```python
# tests/test_config.py
from app.config.settings import settings

def test_config_values():
    assert settings.environment == "development"
    assert settings.enable_cache is True
```

Run:

```bash
pytest -v
```

---

### üì¶ **Summary**

| Concept             | Description                                            |
| ------------------- | ------------------------------------------------------ |
| `.env`              | Stores environment-specific variables                  |
| `pydantic-settings` | Safely loads and validates env data                    |
| Config objects      | Provide clean, typed access to environment variables   |
| Goal                | Separate dev/test/prod configs for reproducible setups |

---

