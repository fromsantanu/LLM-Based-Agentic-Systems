# Chapter 13: Tool Integration

LangGraph is not limited to pure LLM reasoning. Real-world applications often need to interact with **external tools** — APIs, databases, or custom Python functions. Tool integration lets you extend your graph beyond text generation and plug it into actual systems.

---

## 🔑 Key Ideas

1. **External APIs** – Call REST APIs (e.g., weather, stock prices, healthcare APIs).
2. **Databases** – Query SQL/NoSQL databases for structured data retrieval.
3. **Custom Functions** – Define your own Python logic for special tasks.
4. **LLM + Tools** – Use the LLM to decide *when* and *how* to call tools.

---

## 🛠️ Defining a Tool Node

A tool node is simply a function wrapped as a callable inside LangGraph.

```python
from langgraph.graph import StateGraph, END

# Example: Custom weather API call
import requests

def get_weather(location: str) -> str:
    response = requests.get(
        f"https://api.weatherapi.com/v1/current.json",
        params={"key": "your_api_key", "q": location}
    )
    data = response.json()
    return f"The weather in {location} is {data['current']['condition']['text']} at {data['current']['temp_c']}°C."

# Node: LLM generates a location
def ask_location(state: dict):
    return {"location": "London"}

# Node: Weather API tool
def weather_tool(state: dict):
    loc = state["location"]
    return {"weather_report": get_weather(loc)}

# Node: Suggest travel plan
def travel_suggestion(state: dict):
    report = state["weather_report"]
    return {"suggestion": f"Based on {report}, carry an umbrella just in case!"}
```

---

## 🔗 Connecting the Nodes

```python
graph = StateGraph(dict)

graph.add_node("ask_location", ask_location)
graph.add_node("weather_tool", weather_tool)
graph.add_node("travel_suggestion", travel_suggestion)

graph.add_edge("ask_location", "weather_tool")
graph.add_edge("weather_tool", "travel_suggestion")
graph.add_edge("travel_suggestion", END)

app = graph.compile()

print(app.invoke({}))
```

---

## ✅ Output Example

```
{
  "location": "London",
  "weather_report": "The weather in London is Light rain at 14°C.",
  "suggestion": "Based on The weather in London is Light rain at 14°C., carry an umbrella just in case!"
}
```

---

## 📦 Other Tool Integrations

* **Database Query Node**

  ```python
  import sqlite3
  def query_db(state):
      conn = sqlite3.connect("patients.db")
      cur = conn.cursor()
      cur.execute("SELECT * FROM records WHERE id=?", (state["patient_id"],))
      return {"patient_record": cur.fetchone()}
  ```

* **Math Function Node**

  ```python
  def add_numbers(state):
      return {"sum": state["a"] + state["b"]}
  ```

* **Healthcare API Node** (FHIR/HL7)

  * Example: Retrieve patient medication list and pass to treatment recommender node.

---

## 🌟 Example Use Case: Weather-Based Travel Suggestion

1. Node 1 → Ask user location.
2. Node 2 → Call external **Weather API**.
3. Node 3 → Generate travel suggestion (umbrella, sunscreen, jacket).

This pattern can be adapted for:

* Stock alerts
* Medical diagnostics (via API)
* Flight price recommendations
* Patient record retrieval from EHR

---

✅ **You’ve now learned how to plug tools (APIs, DBs, Python functions) into your LangGraph workflows.** This is what makes LangGraph practical for production-grade AI systems.

---

