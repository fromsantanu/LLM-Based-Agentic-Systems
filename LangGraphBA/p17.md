# Chapter 17: Multi-Agent Systems

So far, we have learned about nodes, flows, branching, retries, and persistence. Now we will explore how to **combine multiple specialized agents into a single workflow**. This concept is called **Multi-Agent Systems**.

---

## 1. What are Multi-Agent Systems?

A **multi-agent system (MAS)** is a collection of specialized agents that:

* Work together toward a common goal.
* Handle different stages of a workflow.
* Pass information from one to another in a controlled way.

Each agent is usually **domain-specific** (specialized in one area), but when combined, they create a **complete solution**.

---

## 2. Why Use Multi-Agent Systems?

ðŸ”¹ **Specialization** â†’ Each agent focuses on one task (diagnosis, summarization, compliance, planning).
ðŸ”¹ **Modularity** â†’ You can add, remove, or improve an agent without breaking the entire system.
ðŸ”¹ **Scalability** â†’ Easier to extend into new domains.
ðŸ”¹ **Resilience** â†’ If one agent fails, fallback or retries can be built for just that step.

---

## 3. MAS in LangGraph

LangGraph provides the perfect structure for MAS:

* Each **node** can represent one agent.
* **Edges** define the order of collaboration.
* **State** ensures data is passed along consistently.

---

## 4. Example: Healthcare Workflow

Letâ€™s build a simplified **patient support system** with multiple agents.

### Agents:

1. **Doctor Agent** â†’ Collects patient symptoms.
2. **Diagnostic Agent** â†’ Identifies likely conditions.
3. **Treatment Planner Agent** â†’ Suggests a treatment plan.

---

### 4.1 Code Example

```python
from langgraph.graph import StateGraph, END

# Shared state
class PatientState(dict):
    symptoms: str
    diagnosis: str
    treatment: str

# Agent nodes
def doctor_agent(state: PatientState):
    state["symptoms"] = "Fever, cough, fatigue"
    return state

def diagnostic_agent(state: PatientState):
    if "cough" in state["symptoms"].lower():
        state["diagnosis"] = "Suspected Flu"
    else:
        state["diagnosis"] = "Unknown Condition"
    return state

def treatment_agent(state: PatientState):
    if state["diagnosis"] == "Suspected Flu":
        state["treatment"] = "Rest, hydration, paracetamol"
    else:
        state["treatment"] = "Refer to specialist"
    return state

# Graph setup
graph = StateGraph(PatientState)

graph.add_node("doctor", doctor_agent)
graph.add_node("diagnostic", diagnostic_agent)
graph.add_node("treatment", treatment_agent)

graph.set_entry_point("doctor")
graph.add_edge("doctor", "diagnostic")
graph.add_edge("diagnostic", "treatment")
graph.add_edge("treatment", END)

# Compile and run
app = graph.compile()

final_state = app.invoke({})
print(final_state)
```

---

### 4.2 Output

```text
{
  'symptoms': 'Fever, cough, fatigue',
  'diagnosis': 'Suspected Flu',
  'treatment': 'Rest, hydration, paracetamol'
}
```

---

## 5. Extending the System

You can expand this MAS by adding:

* **Compliance Agent** â†’ Checks drug interactions.
* **Insurance Agent** â†’ Verifies coverage.
* **Recovery Agent** â†’ Monitors progress.

This makes the workflow **end-to-end** and closer to real-world hospital systems.

---

## 6. Key Takeaways

* Multi-Agent Systems = specialized agents working together.
* LangGraph makes MAS easy by mapping each agent to a **node**.
* Information flows via **state**, ensuring consistency.
* MAS design is modular, scalable, and robust.

---

âœ… Next, in **Chapter 18**, we can explore **Human-in-the-Loop Systems** where agents collaborate not only with each other but also with a human decision-maker.

---
