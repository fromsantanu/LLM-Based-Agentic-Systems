# Chapter 6 ‚Äî Visualizing Agent Outputs

## Why visuals matter for agents

Agents make decisions and surface signals (status, risk, progress). Clear visuals help humans audit, trust, and act on those signals quickly‚Äîespecially in healthcare workflows where you want **at-a-glance vitals**, **trendlines**, and **progress to goals**.

## Streamlit building blocks

* `st.metric(label, value, delta=None)`: headline KPIs (latest reading, change since yesterday).
* `st.progress(value)`: progress toward a target or completion of a monitoring window.
* `st.bar_chart(data)`: simple categorical/time-series comparisons (e.g., systolic vs diastolic by day).
* `st.dataframe(data, use_container_width=True)`: sortable, filterable table of raw or agent-enriched outputs.

> Tip: Pair visuals with **plain-language takeaways** (the agent‚Äôs recommendation) right next to the chart.

---

## Example App: Recovery Monitoring Agent Dashboard

A small dashboard that:

1. shows latest vitals as metrics,
2. tracks monitoring progress,
3. compares BP over the last 7‚Äì14 days with a bar chart, and
4. displays the full table the agent used‚Äîplus a concise recommendation panel.

```python
# streamlit run app.py
import streamlit as st
import pandas as pd
from datetime import date, timedelta
import numpy as np

st.set_page_config(page_title="Recovery Monitoring Agent", layout="wide")

# ---- Fake agent data (replace with your agent's output) ----------------------
np.random.seed(7)
days = 14
today = date.today()
dates = [today - timedelta(days=i) for i in range(days)][::-1]

base_temp = 98.4
temps = np.round(base_temp + np.random.normal(0, 0.5, days), 1)  # ¬∞F
systolic = np.clip(np.round(118 + np.random.normal(0, 7, days)), 95, 160).astype(int)
diastolic = np.clip(np.round(76 + np.random.normal(0, 5, days)), 60, 110).astype(int)
pulse = np.clip(np.round(74 + np.random.normal(0, 6, days)), 50, 120).astype(int)

df = pd.DataFrame({
    "date": dates,
    "temperature_F": temps,
    "systolic": systolic,
    "diastolic": diastolic,
    "pulse_bpm": pulse
})
df["fever_flag"] = df["temperature_F"] >= 100.4
df["bp_stage"] = pd.cut(
    df["systolic"],
    bins=[0, 119, 129, 139, 1000],
    labels=["Normal", "Elevated", "Stage 1", "Stage 2"]
)

# Agent-style summary (you‚Äôd compute this from your model/tool outputs)
latest = df.iloc[-1]
delta_temp = latest["temperature_F"] - df.iloc[-2]["temperature_F"]
delta_sys = latest["systolic"] - df.iloc[-2]["systolic"]
delta_dia = latest["diastolic"] - df.iloc[-2]["diastolic"]

fever_days_last7 = int(df.tail(7)["fever_flag"].sum())
bp_stage_counts = df["bp_stage"].value_counts()

# ---- Header ------------------------------------------------------------------
st.title("üè• Recovery Monitoring Agent")
st.caption("Daily temperature, blood pressure, and pulse with human-readable recommendations.")

# ---- KPIs --------------------------------------------------------------------
kpi1, kpi2, kpi3 = st.columns(3)
kpi1.metric("Temperature (¬∞F)", f"{latest['temperature_F']:.1f}",
            delta=f"{delta_temp:+.1f} vs prev")
kpi2.metric("Systolic (mmHg)", f"{latest['systolic']}",
            delta=f"{int(delta_sys):+d} vs prev")
kpi3.metric("Diastolic (mmHg)", f"{latest['diastolic']}",
            delta=f"{int(delta_dia):+d} vs prev")

# ---- Progress toward monitoring goal -----------------------------------------
st.subheader("Monitoring Progress")
target_days = 30
progress = min(len(df) / target_days, 1.0)
st.progress(progress)
st.caption(f"{len(df)}/{target_days} days recorded")

# ---- Charts ------------------------------------------------------------------
left, right = st.columns([1.2, 1])

with left:
    st.subheader("Blood Pressure ‚Äî Last 14 Days")
    bp_chart = df.set_index("date")[["systolic", "diastolic"]]
    st.bar_chart(bp_chart)

with right:
    st.subheader("Agent Summary")
    st.write(
        f"- **Fever days (last 7):** {fever_days_last7}\n"
        f"- **BP stages (14 days):** " +
        ", ".join([f"{stage}: {count}" for stage, count in bp_stage_counts.items()])
    )

    # Simple rules ‚Üí human-readable recs (replace with LLM or rules engine)
    recs = []
    if fever_days_last7 >= 2:
        recs.append("Fever pattern detected twice in last 7 days ‚Üí increase fluids, track symptoms, consider teleconsult.")
    if latest["systolic"] >= 140 or latest["diastolic"] >= 90:
        recs.append("Hypertensive range today ‚Üí rest, recheck in 1‚Äì2 hours; if persistent with symptoms, seek care.")
    elif latest["systolic"] >= 130 or latest["diastolic"] >= 80:
        recs.append("Elevated BP today ‚Üí reduce salt, mindfulness, and monitor closely for next 48 hours.")
    if latest["pulse_bpm"] > 100 and latest["temperature_F"] > 99.5:
        recs.append("Tachycardia with elevated temp ‚Üí assess hydration, watch for infection symptoms.")

    if not recs:
        recs = ["All readings within expected ranges. Continue routine monitoring."]

    for r in recs:
        st.success(r)

# ---- Raw table (auditable) ---------------------------------------------------
st.subheader("Daily Readings (Agent Input/Output Table)")
st.dataframe(
    df.sort_values("date", ascending=False),
    use_container_width=True
)
```

### What to notice

* **KPI first**: `st.metric` surfaces the *latest* state + deltas.
* **Progress as context**: `st.progress` shows adherence to the plan (e.g., 30-day recovery).
* **Simple comparisons**: `st.bar_chart` makes systolic vs diastolic clear per day.
* **Auditability**: `st.dataframe` exposes the exact rows behind the visuals.
* **Actionable text**: Right-hand recommendations translate numbers into next steps.

---

## Design tips for agent dashboards

* Put **KPIs** and **alerts** above the fold; charts and tables support them.
* Keep **units** and **reference ranges** visible (mmHg, ¬∞F).
* Add **threshold coloring** (e.g., fever ‚â• 100.4 ¬∞F) when using dataframes (via Styler) if needed.
* Separate **agent reasoning** (why) from **recommendations** (what to do).
* When possible, log the agent‚Äôs inputs/outputs and show a **‚Äúdata freshness‚Äù** timestamp.

