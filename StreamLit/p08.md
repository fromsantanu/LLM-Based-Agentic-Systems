# Chapter 8: File Uploads & Reports

In a real-world healthcare or research assistant system, patients and doctors often exchange **files**—lab reports, imaging summaries, CSV logs of vitals, or scanned PDFs. Streamlit makes it simple to handle file uploads and integrate them into an agent pipeline for automated analysis.

---

## 8.1 Handling File Uploads in Streamlit

Streamlit provides the `st.file_uploader` widget to allow users to upload one or more files into the app.

```python
import streamlit as st
import pandas as pd

st.title("Upload a Lab Report")

uploaded_file = st.file_uploader("Upload a blood test CSV", type=["csv"])

if uploaded_file is not None:
    df = pd.read_csv(uploaded_file)
    st.write("Preview of your report:")
    st.dataframe(df.head())
```

* `type=["csv"]` restricts uploads to CSV files.
* If you want multiple files, pass `accept_multiple_files=True`.
* Uploaded files are handled as in-memory objects (`BytesIO`), so they can be directly passed to agents.

---

## 8.2 Agents Parsing Uploaded Files

Once uploaded, the file content can be forwarded to a **Diagnostic Agent** or other domain-specific agents for analysis.
For example:

```python
from some_agent_module import diagnostic_agent  # placeholder

if uploaded_file is not None:
    df = pd.read_csv(uploaded_file)
    
    # Convert DataFrame to structured input
    patient_data = df.to_dict(orient="records")
    
    # Send to diagnostic agent
    results = diagnostic_agent.analyze(patient_data)
    
    # Display results
    st.subheader("Agent’s Analysis")
    st.write(results["summary"])
    st.write("Recommendations:")
    for rec in results["recommendations"]:
        st.markdown(f"- {rec}")
```

Here, the Diagnostic Agent could run checks such as:

* Detecting abnormal ranges (e.g., hemoglobin too low).
* Comparing against reference values.
* Suggesting follow-up tests or lifestyle changes.

---

## 8.3 Example Walkthrough

Let’s simulate a **Blood Test CSV upload → Diagnostic Agent analysis → Streamlit summary**.

### Sample CSV (uploaded by user):

```
Test,Result,Reference
Hemoglobin,10.2,13-17
WBC,12000,4000-11000
Cholesterol,220,<200
```

### Agent Logic (simplified pseudocode):

```python
def analyze(patient_data):
    findings = []
    recommendations = []
    
    for row in patient_data:
        test = row["Test"]
        result = float(row["Result"])
        
        # Example simple checks
        if test == "Hemoglobin" and result < 13:
            findings.append("Low Hemoglobin detected.")
            recommendations.append("Consider iron supplementation and further tests.")
        if test == "WBC" and result > 11000:
            findings.append("High WBC count detected (possible infection).")
            recommendations.append("Follow up with a physician.")
        if test == "Cholesterol" and result > 200:
            findings.append("Elevated cholesterol levels.")
            recommendations.append("Adopt a heart-healthy diet and exercise plan.")
    
    return {
        "summary": "\n".join(findings),
        "recommendations": recommendations
    }
```

### Streamlit Output:

* **Summary of Findings:**

  * Low Hemoglobin detected.
  * High WBC count detected (possible infection).
  * Elevated cholesterol levels.

* **Recommendations:**

  * Consider iron supplementation and further tests.
  * Follow up with a physician.
  * Adopt a heart-healthy diet and exercise plan.

---

## 8.4 Beyond CSVs

Other file types you may want to support:

* **PDF Reports** → Parse with `PyPDF2` or `pdfplumber`, then analyze text with an agent.
* **Medical Imaging (DICOM, JPG, PNG)** → Extract metadata (age, modality, scan type), pass images to vision agents.
* **JSON/Excel Logs** → Upload with `st.file_uploader`, load with `json` or `pandas.read_excel()`.

---

✅ **Key Takeaway**:
With just `st.file_uploader` + agent integration, your app can handle **patient lab reports, imaging data, or structured datasets**. This allows patients and doctors to exchange information seamlessly and receive **automated, AI-powered insights**.

---
