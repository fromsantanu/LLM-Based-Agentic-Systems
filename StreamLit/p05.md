# Chapter 5 : Form Handling and Validation for Agent Inputs

So far, we’ve focused on text inputs, chat-like UIs, and multi-agent dashboards. But in many **agentic applications**, especially in **healthcare or regulated domains**, free-form text isn’t enough. You need **structured input forms** where users provide details in a standardized way. This ensures that **downstream agents** (like diagnostic or triage agents) receive clean, validated data.

---

### 📌 Why Use Forms in Streamlit?

* **Consistency**: All users submit data in the same structured format.
* **Validation**: Prevents incorrect or incomplete data from reaching agents.
* **Reusability**: Forms can be reused across workflows like intake, order placement, or evaluation.
* **Traceability**: Each submission can be logged for monitoring and debugging.

Streamlit provides the `st.form` and `st.form_submit_button` APIs to handle structured inputs.

---

### 📝 Basic Form Syntax

```python
import streamlit as st

with st.form("example_form"):
    name = st.text_input("Patient Name")
    age = st.number_input("Age", min_value=0, max_value=120)
    submitted = st.form_submit_button("Submit")

if submitted:
    st.write(f"Patient: {name}, Age: {age}")
```

Key points:

* All inputs inside `st.form` are grouped.
* Data is only sent when the **Submit** button is clicked.
* Prevents partial/accidental submissions.

---

### ✅ Validation Logic

Before passing inputs to an agent, we must **validate** them.
For example:

* **Age**: must be a positive integer within a realistic range.
* **Symptoms**: cannot be empty.
* **Allergies**: optional, but if filled, should be a string.

Validation can be done with simple `if` statements.

---

### 🏥 Example: Patient Intake Form

Below is a complete example simulating a **Patient Intake Form** that validates inputs before sending to a **Triage Agent**:

```python
import streamlit as st

st.title("🏥 Patient Intake Form")

with st.form("intake_form"):
    # Basic Info
    name = st.text_input("Full Name")
    age = st.number_input("Age", min_value=0, max_value=120, step=1)
    gender = st.selectbox("Gender", ["Select", "Male", "Female", "Other"])
    
    # Medical Info
    symptoms = st.text_area("Symptoms (comma-separated)")
    allergies = st.text_input("Known Allergies (optional)")
    
    submitted = st.form_submit_button("Submit")

if submitted:
    errors = []
    
    # Validation checks
    if not name.strip():
        errors.append("Name is required.")
    if gender == "Select":
        errors.append("Please select a gender.")
    if not symptoms.strip():
        errors.append("At least one symptom is required.")
    
    if errors:
        st.error("⚠️ Please fix the following issues:")
        for err in errors:
            st.write(f"- {err}")
    else:
        st.success("✅ Patient data validated successfully!")
        
        # Pack data for Triage Agent
        patient_data = {
            "name": name,
            "age": age,
            "gender": gender,
            "symptoms": [s.strip() for s in symptoms.split(",")],
            "allergies": allergies.split(",") if allergies else []
        }
        
        # Simulate sending to agent
        st.write("📤 Sending to Triage Agent...")
        st.json(patient_data)
```

---

### 🔍 What Happens Here

1. User fills out **structured fields** (name, age, gender, symptoms, allergies).
2. Input is **validated** for completeness and correctness.
3. If errors exist, the app displays them and prevents submission.
4. If all checks pass, the data is **packaged into JSON** and sent to the agent.
5. The agent can now process clean, structured data without worrying about raw input errors.

---

### ⚡ Extensions

* **Date Inputs**: Add `st.date_input` for admission date.
* **Multi-Select**: Use `st.multiselect` for symptom checklists.
* **Conditional Fields**: Show specific fields based on earlier selections.
* **Integration with LangChain/LangGraph**: Pass validated `patient_data` directly to a diagnostic pipeline.

---

✅ With forms and validation, you’ve introduced **structured reliability** into your agent workflows. This ensures downstream processing is accurate, efficient, and safe.

---
