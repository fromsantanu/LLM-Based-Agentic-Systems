# ğŸ“˜ Chapter 11: Indexing for Faster Vector Search

So far, your vector search **works**.
Now we make it **fast**.

Think of indexing like adding a **map to a big city**â€”you reach places quickly instead of walking everywhere.

---

## 1. Why Do We Need Indexing?

Without an index, the database:

* Looks at **every row**
* Compares **every vector**
* Becomes slow as data grows

With an index, the database:

* Looks only at **likely candidates**
* Skips unnecessary rows
* Becomes **much faster**

This is especially important in **Supabase**, which runs on **PostgreSQL**.

---

## 2. Simple Real-Life Analogy

ğŸ“š Library without index:

* You scan every book title

ğŸ“š Library with index:

* You go straight to the right shelf

Vector index = **that shelf map**.

---

## 3. When Do You Actually Need a Vector Index?

You **do NOT need indexing** when:

* You have < 1,000 rows
* You are learning or testing
* You donâ€™t care about speed yet

You **DO need indexing** when:

* Thousands of rows or more
* Users wait for results
* Chatbots feel slow

ğŸ“Œ Rule of thumb:

> Start without index â†’ add index when needed

---

## 4. Types of Vector Indexes in pgvector

pgvector provides **two main index types**:

1ï¸âƒ£ IVFFlat
2ï¸âƒ£ HNSW

Weâ€™ll explain both **without math**.

---

## 5. IVFFlat Index (Beginner-Friendly)

### What It Does

* Groups vectors into **clusters**
* Searches only inside relevant clusters

### Think of It Like

* City divided into zones
* You search only the right zone

### Pros

* Easy to create
* Uses less memory
* Stable

### Cons

* Slightly less accurate than HNSW
* Needs tuning

---

### How to Create IVFFlat Index

```sql
create index documents_embedding_idx
on documents
using ivfflat (embedding vector_cosine_ops)
with (lists = 100);
```

### Simple Meaning

* `ivfflat` â†’ index type
* `vector_cosine_ops` â†’ cosine similarity
* `lists = 100` â†’ number of clusters

ğŸ“Œ Bigger data â†’ bigger lists value.

---

## 6. HNSW Index (Faster & Smarter)

### What It Does

* Builds a **smart navigation graph**
* Jumps quickly to nearest vectors

### Think of It Like

* Google Maps shortcuts
* Not straight roads, but fast paths

### Pros

* Very fast
* Very accurate

### Cons

* Uses more memory
* Slightly complex

---

### How to Create HNSW Index

```sql
create index documents_embedding_hnsw_idx
on documents
using hnsw (embedding vector_cosine_ops);
```

ğŸ“Œ No tuning needed for beginners.

---

## 7. Which Index Should You Choose?

| Situation            | Recommendation |
| -------------------- | -------------- |
| Learning / testing   | No index       |
| Medium data          | IVFFlat        |
| Large data / chatbot | HNSW           |
| Want best accuracy   | HNSW           |
| Want low memory      | IVFFlat        |

ğŸ‘‰ **HNSW is the modern default**.

---

## 8. Important Rule: Index Depends on Distance Type

If your search uses:

* Cosine similarity â†’ use `vector_cosine_ops`
* Euclidean â†’ use `vector_l2_ops`

ğŸ“Œ Index and search **must match**.

---

## 9. Does Index Change Search Results?

Yes, slightly.

* Indexed search = **approximate**
* Non-indexed search = **exact but slow**

In practice:

* Difference is small
* Speed gain is huge

---

## 10. Common Beginner Mistakes

âŒ Creating index before inserting data
âŒ Using wrong distance operator
âŒ Expecting index on very small tables
âŒ Forgetting to ANALYZE after index

ğŸ“Œ Insert data first, then index.

---

## 11. Mental Picture to Remember

ğŸ—„ Vector table
â• Vector index
âš¡ Fast similarity search

---

## âœ… Chapter 11 Summary

* Indexing makes vector search fast
* Not needed for small datasets
* IVFFlat = simple and memory-friendly
* HNSW = fastest and most accurate
* Index must match distance type
* Essential for production systems

---

