# ðŸ“˜ Chapter 10: Filtering Vector Search with Metadata

Until now, our vector search was **smart**, but a bit **too open**.
Now we add **control**, like telling a librarian *which section to search*.

---

## 1. Why Metadata Filtering Is Necessary

Vector search answers:

> â€œWhat is similar in meaning?â€

Metadata filtering answers:

> â€œFrom **which group** should I search?â€

Without filtering:

* Medical + education + notes all mix
* Results can be confusing

With filtering:

* Search becomes **focused and accurate**

---

## 2. Simple Real-Life Analogy

Imagine a library ðŸ“š

You ask:

> â€œBooks about heart treatmentâ€

Librarian asks back:

* Medical section?
* Research journals?
* Student notes?

ðŸ‘‰ Metadata is that **extra instruction**.

---

## 3. What Is Metadata Again? (Quick Reminder)

Metadata is **information about the text**, not the text itself.

Stored as `jsonb`, for example:

```json
{
  "type": "medical",
  "topic": "cardiology",
  "year": 2024,
  "source": "pdf"
}
```

Each row can have **different metadata**.

---

## 4. How Filtering Works in Supabase

In **Supabase**, filtering happens using:

```sql
metadata @> filter
```

Meaning:

> â€œMetadata must contain the filter valuesâ€

---

## 5. Simple Filtering Example

### Stored metadata:

```json
{
  "topic": "cardiology",
  "year": 2024
}
```

### Filter used in search:

```json
{"topic":"cardiology"}
```

âœ… Match found

---

### Filter:

```json
{"topic":"neurology"}
```

âŒ No match

---

## 6. Using Filters with `match_documents`

Recall our function from Chapter 9.

We now **use it properly**.

### Example Call (Conceptual)

```sql
select * from match_documents(
  '[query_embedding]',
  5,
  '{"topic":"cardiology"}'
);
```

This means:

* Search by meaning
* Only inside **cardiology** documents
* Return top 5

---

## 7. Multiple Filters at the Same Time

You can filter on **many fields**.

Example:

```json
{
  "topic": "cardiology",
  "year": 2024,
  "source": "pdf"
}
```

Only rows matching **all conditions** will be searched.

ðŸ“Œ This is called **AND filtering**.

---

## 8. What Metadata Is Best for Filtering?

Good metadata fields:

* `type` â†’ medical, education, notes
* `topic` â†’ cardiology, diabetes
* `source` â†’ pdf, website
* `year` â†’ 2023, 2024
* `author` â†’ optional

Bad metadata fields:

* Long text
* Full paragraphs
* Random notes

ðŸ‘‰ Metadata should be **small, structured, predictable**.

---

## 9. Filtering vs Similarity (Very Important Concept)

Order of operations:

1. Metadata filter applied first
2. Vector similarity search happens **only on filtered rows**

This makes:

* Search faster
* Results cleaner
* Less confusion

---

## 10. Common Beginner Mistakes

âŒ Using text instead of JSON
âŒ Typing wrong key names (`Topic` vs `topic`)
âŒ Expecting partial matches in metadata
âŒ Over-filtering and getting zero results

ðŸ“Œ Start with simple filters.

---

## 11. Debugging Tip (Very Useful)

If search returns nothing:

1. Try filter `{}` (no filter)
2. If results appear â†’ filter is the problem
3. Check metadata spelling and values

---

## 12. Mental Picture to Remember

ðŸŽ¯ Metadata filter
â¬‡
ðŸ“ Vector similarity
â¬‡
ðŸ¥‡ Best results

---

## âœ… Chapter 10 Summary

* Metadata filtering adds **control**
* Filters limit *where* vector search runs
* Uses `jsonb` containment (`@>`)
* Supports multiple conditions
* Improves accuracy and speed
* Essential for real-world apps

---

