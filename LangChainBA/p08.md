# 8. Working with APIs & Data Sources

LangChain is powerful not only because it connects to LLMs but also because it integrates seamlessly with **data sources and APIs**. This allows you to build applications that query databases, fetch real-time data, and parse structured responses.

---

## SQL Database Agent

Many enterprise applications need to query relational databases. With LangChain, you can create an **SQL agent** that takes a natural language question, converts it into SQL, runs the query, and returns the result.

**Use Case:**

* Query hospital admissions database: *“How many patients were admitted last week with dengue fever?”*
* Query sales database: *“Show me the top 5 products by revenue in August.”*

---

## API Chains

LangChain can integrate with **external APIs** like weather, finance, medical databases, or custom REST APIs.
An **API Chain** is designed to take user input, call the external API, and pass the response back into the LLM for interpretation or formatting.

**Use Case:**

* Fetch current stock price from Yahoo Finance API.
* Get weather forecast for a given city.
* Query a hospital’s internal REST API for available ICU beds.

---

## JSON Agents

Often, APIs return data in **JSON format**.
LangChain includes utilities for parsing JSON and enabling the LLM to work with structured data.
A **JSON Agent** allows you to extract fields, manipulate nested objects, and answer questions based on structured outputs.

**Use Case:**

* Parse patient test reports stored as JSON.
* Extract product prices from an e-commerce API response.
* Summarize fields in a JSON object returned by a news API.

---

## Example: Query a SQL Database and Fetch Weather Data

Let’s create a LangChain script where:

1. The user can ask a natural language question about a **local database** (SQLite).
2. Or ask a weather-related question, which is answered using an **external API**.
3. The system routes the query to the correct agent.

```python
from langchain_openai import ChatOpenAI
from langchain.agents import initialize_agent, Tool
from langchain_community.agent_toolkits import create_sql_agent
from langchain_community.utilities import SQLDatabase
import requests

# Step 1: LLM
llm = ChatOpenAI(model="gpt-4", temperature=0)

# Step 2: SQL Database Agent
db = SQLDatabase.from_uri("sqlite:///hospital.db")  # replace with your DB
sql_agent = create_sql_agent(llm, db, verbose=True)

# Step 3: Weather API Tool
def get_weather(city: str) -> str:
    url = f"https://wttr.in/{city}?format=3"
    response = requests.get(url)
    return response.text

weather_tool = Tool(
    name="WeatherAPI",
    func=get_weather,
    description="Get the current weather for a given city"
)

# Step 4: Combine into a single agent
tools = [weather_tool]
agent = initialize_agent(tools, llm, agent="zero-shot-react-description", verbose=True)

# Example 1: SQL Query
sql_result = sql_agent.run("How many dengue patients were admitted last week?")
print("SQL Result:", sql_result)

# Example 2: Weather API Query
weather_result = agent.run("What's the weather in London right now?")
print("Weather Result:", weather_result)
```

---

✅ **What’s happening here?**

* `create_sql_agent`: lets you ask natural questions → SQL → DB results.
* `get_weather`: small Python wrapper to call an external API.
* `initialize_agent`: combines tools and routes queries appropriately.

---

📌 **Key Takeaways**

* **SQL Database Agent** turns natural language → SQL queries → results.
* **API Chains** connect to real-time data sources.
* **JSON Agents** parse structured API responses.
* You can combine them into **multi-tool agents** for powerful workflows.

---
