Let’s build an **agent that can answer questions, run calculations, and fetch current news** using LangChain tools.

---

# Goal

* **Answer questions** → handled by the LLM itself
* **Run calculations** → via a **Python REPL tool**
* **Fetch current news** → via a **web search tool** (Tavily or SerpAPI)

> You’ll need: `OPENAI_API_KEY` and either `TAVILY_API_KEY` (recommended) or `SERPAPI_API_KEY`.

---

## 1) Install & set keys

```bash
pip install -U langchain langchain-openai langchain-community tavily-python
# If you prefer SerpAPI instead of Tavily:
# pip install -U google-search-results
```

```bash
# macOS/Linux
export OPENAI_API_KEY="sk-..."
export TAVILY_API_KEY="tvly-..."
# or SerpAPI: export SERPAPI_API_KEY="..."
```

---

## 2) Define tools

We’ll wire up:

* **Python REPL** for math/logic
* **TavilySearchResults** for news/web
* (LLM answers simple questions directly)

```python
from langchain_openai import ChatOpenAI
from langchain.agents import AgentType, initialize_agent
from langchain_community.tools import PythonREPLTool
from langchain_community.tools.tavily_search import TavilySearchResults
# If using SerpAPI instead:
# from langchain_community.utilities import SerpAPIWrapper
# from langchain.agents import load_tools

# 1) LLM
llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)

# 2) Tools
python_tool = PythonREPLTool()  # Executes Python code safely in a REPL

news_tool = TavilySearchResults(
    max_results=5,  # you can tweak for more/less results
    include_answer=True,  # let Tavily synthesize a short answer
)

tools = [python_tool, news_tool]

# 3) Agent: Zero-Shot ReAct with tools
agent = initialize_agent(
    tools=tools,
    llm=llm,
    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
    handle_parsing_errors=True,
    verbose=True,
)
```

---

## 3) Use the agent

### A) General questions (LLM only)

```python
agent.run("Explain the difference between precision and recall in one paragraph.")
```

### B) Calculations (routes to Python REPL)

```python
agent.run("Compute the compound interest for principal=12000, rate=6.5% yearly, time=3 years, compounded monthly.")
```

### C) Current news (routes to search)

```python
agent.run("What’s the latest on AI policy changes in the EU this week? Give sources.")
```

> The agent will **think** (ReAct), decide which tool to call, execute it, observe outputs, and synthesize a final answer.

---

## 4) A slightly more guided prompt style (optional)

If you want to make the agent explicitly consider all three capabilities, wrap user asks in a **router prompt**:

```python
ROUTER_INSTRUCTIONS = """You can: 
1) Answer with general knowledge using your own reasoning.
2) Run math or data logic with the Python REPL tool.
3) Fetch fresh news with the Tavily search tool (include sources).
Choose tools only when needed and show clear, concise results.
"""

def ask(q: str):
    return agent.run(f"{ROUTER_INSTRUCTIONS}\nUser: {q}")

print(ask("Summarize why transformers enabled large language models."))
print(ask("Calculate the standard deviation of [2, 4, 4, 4, 5, 5, 7, 9]."))
print(ask("Latest breakthroughs in cancer immunotherapy this month? Cite sources."))
```

---

## 5) Tips & gotchas

* **Determinism for math**: keep `temperature=0`.
* **Tool descriptions matter** (they guide the agent’s routing).
* **News quality**: Tavily generally gives clean, current results with source links.
* **Guardrails**: for production, add timeouts, output length limits, and sanitize Python inputs if you expose the REPL beyond the agent.

---

## 6) Minimal end-to-end script

Drop this in `agent_news_calc.py` and run.

```python
from langchain_openai import ChatOpenAI
from langchain.agents import AgentType, initialize_agent
from langchain_community.tools import PythonREPLTool
from langchain_community.tools.tavily_search import TavilySearchResults

def build_agent():
    llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)
    tools = [
        PythonREPLTool(description="Execute Python code for calculations or data processing."),
        TavilySearchResults(max_results=5, include_answer=True, description="Search the web and fetch recent news with citations."),
    ]
    return initialize_agent(
        tools=tools,
        llm=llm,
        agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
        handle_parsing_errors=True,
        verbose=True,
    )

if __name__ == "__main__":
    agent = build_agent()

    print("\n=== Q&A ===")
    print(agent.run("In simple terms, what is overfitting in machine learning?"))

    print("\n=== CALC ===")
    print(agent.run("Using Python, compute the eigenvalues of [[2,1],[1,2]]."))

    print("\n=== NEWS ===")
    print(agent.run("Give me the top 3 AI governance news items from the last 7 days with links."))
```

---
