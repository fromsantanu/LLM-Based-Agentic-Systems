# **Chapter 5. CRUD Operations**

CRUD (Create, Read, Update, Delete) operations are the foundation of working with any database, including vector databases like **Qdrant**. In this chapter, we will walk through how to add, retrieve, update, and delete vectors and their associated metadata (payloads).

---

## Adding Documents with `add()`

In Qdrant, documents are stored as **points**. Each point consists of:

* A **unique ID**
* A **vector** (embedding)
* An optional **payload** (metadata in JSON form)

### Example (Python client)

```python
from qdrant_client import QdrantClient
from qdrant_client.http import models
import numpy as np

# Connect to Qdrant (local instance on default port)
client = QdrantClient("http://localhost:6333")

# Example vector (embedding of dimension 4)
vector = np.random.rand(4).tolist()

# Insert a point
client.upsert(
    collection_name="demo_collection",
    points=[
        models.PointStruct(
            id=1,
            vector=vector,
            payload={"category": "article", "title": "Intro to Qdrant"}
        )
    ]
)
```

✅ The `upsert` method adds a new point or updates it if the ID already exists.

---

## Fetching Documents with `get()`

You can fetch points by their IDs using the `get()` method. This is useful for verifying insertions or retrieving metadata.

### Example

```python
result = client.retrieve(
    collection_name="demo_collection",
    ids=[1],
    with_vectors=True,
    with_payload=True
)

print(result)
```

* `with_vectors=True` → returns stored vector
* `with_payload=True` → returns metadata

---

## Updating Points and Metadata

You can update:

* The **vector** (by re-inserting with the same ID using `upsert`)
* The **payload/metadata** (using `set_payload`)

### Example (update payload only)

```python
# Update metadata for point ID=1
client.set_payload(
    collection_name="demo_collection",
    payload={"category": "tutorial", "author": "Santanu"},
    points=[1]
)

# Fetch updated point
updated = client.retrieve(
    collection_name="demo_collection",
    ids=[1],
    with_payload=True
)
print(updated)
```

---

## Deleting Vectors and Collections

### Delete a single point

```python
client.delete(
    collection_name="demo_collection",
    points_selector=models.PointIdsList(points=[1])
)
```

### Delete all points with a filter

```python
client.delete(
    collection_name="demo_collection",
    points_selector=models.FilterSelector(
        filter=models.Filter(
            must=[models.FieldCondition(key="category", match=models.MatchValue(value="tutorial"))]
        )
    )
)
```

### Drop an entire collection

```python
client.delete_collection("demo_collection")
```

---

## Summary

* **Add:** Use `upsert()` to insert new vectors with metadata.
* **Fetch:** Use `retrieve()` to get vectors and payloads by ID.
* **Update:** Use `set_payload()` for metadata or `upsert()` for vectors.
* **Delete:** Use `delete()` for points or `delete_collection()` to drop everything.

CRUD operations give you full control over your vector data lifecycle in Qdrant.

---
