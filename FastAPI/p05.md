# Chapter 5: Request Handling

In this chapter, weâ€™ll learn how FastAPI handles different types of incoming requests such as **form submissions, file uploads, JSON, text, and binary data**. This is crucial for building APIs that interact with real-world applications (e.g., web forms, file-based uploads, or raw binary streams).

---

## 5.1 Form Data Submission

When submitting data from HTML forms (using `application/x-www-form-urlencoded` or `multipart/form-data`), FastAPI provides the `Form` class.

### Example: Submitting Form Data

```python
from fastapi import FastAPI, Form

app = FastAPI()

@app.post("/login/")
async def login(username: str = Form(...), password: str = Form(...)):
    return {"username": username, "message": "Login successful"}
```

ðŸ”¹ Here:

* `Form(...)` indicates that the parameter should come from form fields.
* Form data is typically used for login, signup, and search inputs.

---

## 5.2 File Uploads

FastAPI makes handling file uploads straightforward using `File` and `UploadFile`.

* **`File`** â†’ Loads the file into memory as `bytes`. Suitable for small files.
* **`UploadFile`** â†’ Provides a file-like object with async methods, better for large files.

### Example: Uploading a File

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/upload/")
async def upload_file(file: UploadFile = File(...)):
    contents = await file.read()
    return {
        "filename": file.filename,
        "content_type": file.content_type,
        "size": len(contents)
    }
```

ðŸ”¹ Advantages of `UploadFile`:

* Doesnâ€™t load entire file into memory at once.
* Exposes `.filename`, `.content_type`, `.read()`, `.write()`, `.seek()` methods.

---

## 5.3 Handling JSON Requests

APIs commonly receive **JSON payloads**. FastAPI automatically parses JSON into Python data structures when using **Pydantic models** or standard types.

### Example: Handling JSON

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Profile(BaseModel):
    name: str
    age: int
    email: str

@app.post("/profile/")
async def create_profile(profile: Profile):
    return {"message": f"Profile created for {profile.name}"}
```

ðŸ”¹ The request body should be in JSON format:

```json
{
  "name": "Alice",
  "age": 25,
  "email": "alice@example.com"
}
```

---

## 5.4 Handling Text Requests

Sometimes APIs just need raw text input. You can declare the type as `str`.

```python
from fastapi import FastAPI

app = FastAPI()

@app.post("/echo/")
async def echo_text(text: str):
    return {"received_text": text}
```

ðŸ”¹ Sending plain text (e.g., `curl`):

```bash
curl -X POST "http://127.0.0.1:8000/echo/" -H "Content-Type: text/plain" -d "Hello FastAPI"
```

---

## 5.5 Handling Binary Requests

For raw binary data (e.g., images, PDFs, encrypted data), declare the body as `bytes`.

```python
from fastapi import FastAPI

app = FastAPI()

@app.post("/binary/")
async def upload_binary(data: bytes):
    return {"size": len(data), "message": "Binary data received"}
```

ðŸ”¹ Example usage:

```bash
curl -X POST "http://127.0.0.1:8000/binary/" \
     -H "Content-Type: application/octet-stream" \
     --data-binary "@example.pdf"
```

---

## 5.6 Combined Example: Profile Upload API with Image + Form Fields

Letâ€™s combine **form data + file upload** into a real-world example.

```python
from fastapi import FastAPI, Form, UploadFile, File

app = FastAPI()

@app.post("/upload-profile/")
async def upload_profile(
    name: str = Form(...),
    age: int = Form(...),
    bio: str = Form(None),
    profile_image: UploadFile = File(...)
):
    # Read file contents
    image_content = await profile_image.read()
    
    return {
        "name": name,
        "age": age,
        "bio": bio,
        "filename": profile_image.filename,
        "content_type": profile_image.content_type,
        "image_size": len(image_content)
    }
```

### Example Request:

* **Form fields:** `name=Alice`, `age=25`, `bio=AI Enthusiast`
* **File:** `profile.jpg`

Response:

```json
{
  "name": "Alice",
  "age": 25,
  "bio": "AI Enthusiast",
  "filename": "profile.jpg",
  "content_type": "image/jpeg",
  "image_size": 52341
}
```

---

âœ… **Summary**

* Use `Form` for HTML form submissions.
* Use `File` / `UploadFile` for file uploads (prefer `UploadFile` for large files).
* Use **Pydantic models** for JSON.
* Use `str` for plain text, and `bytes` for raw binary.
* You can **combine form fields with file uploads** in the same endpoint.

---
