# Chapter 6: Response Handling

In FastAPI, responses are flexible. You can return JSON (default), HTML, plain text, files, or even **streaming data**. This chapter explores how to handle different response types.

---

## 6.1 Custom Response Types

By default, FastAPI returns JSON responses. But sometimes you need more controlâ€”like plain text, HTML, or custom headers. FastAPI provides several response classes in `fastapi.responses`.

### JSONResponse

Explicitly return JSON with custom status codes or headers.

```python
from fastapi import FastAPI
from fastapi.responses import JSONResponse

app = FastAPI()

@app.get("/json")
def get_json():
    data = {"message": "Hello, JSON!"}
    return JSONResponse(content=data, status_code=200, headers={"X-Custom-Header": "FastAPI"})
```

---

### HTMLResponse

Useful for returning raw HTML.

```python
from fastapi.responses import HTMLResponse

@app.get("/html", response_class=HTMLResponse)
def get_html():
    html_content = """
    <html>
        <head><title>Hello HTML</title></head>
        <body><h1>Welcome to FastAPI</h1></body>
    </html>
    """
    return html_content
```

---

### PlainTextResponse

Best for debugging or APIs that need text-only output.

```python
from fastapi.responses import PlainTextResponse

@app.get("/text", response_class=PlainTextResponse)
def get_text():
    return "This is plain text response."
```

---

## 6.2 Streaming Responses

When sending large data (logs, live updates, large file processing), use **streaming** to avoid loading everything into memory.

```python
from fastapi.responses import StreamingResponse
import time

def generate_numbers():
    for i in range(1, 6):
        yield f"Number: {i}\n"
        time.sleep(1)

@app.get("/stream")
def get_stream():
    return StreamingResponse(generate_numbers(), media_type="text/plain")
```

ðŸ’¡ This sends data **chunk by chunk** instead of all at once.

---

## 6.3 Returning Files

You can return files directlyâ€”PDFs, CSVs, or images. FastAPI provides `FileResponse`.

```python
from fastapi.responses import FileResponse

@app.get("/get-file")
def get_file():
    return FileResponse("sample.pdf", media_type="application/pdf", filename="report.pdf")
```

* `media_type` ensures correct MIME type.
* `filename` controls the download name.

---

## 6.4 Example: Export Data to CSV

Letâ€™s create an endpoint that generates a CSV file dynamically and returns it.

```python
import csv
import io
from fastapi.responses import StreamingResponse

@app.get("/export-csv")
def export_csv():
    data = [
        {"id": 1, "name": "Alice", "score": 90},
        {"id": 2, "name": "Bob", "score": 85},
        {"id": 3, "name": "Charlie", "score": 95},
    ]
    
    def generate():
        buffer = io.StringIO()
        writer = csv.DictWriter(buffer, fieldnames=["id", "name", "score"])
        writer.writeheader()
        for row in data:
            writer.writerow(row)
            yield buffer.getvalue()
            buffer.seek(0)
            buffer.truncate(0)
    
    return StreamingResponse(generate(), media_type="text/csv", headers={"Content-Disposition": "attachment; filename=students.csv"})
```

ðŸ‘‰ Visiting `/export-csv` will **download a CSV file** with student data.

---

## âœ… Key Takeaways

* Use `JSONResponse`, `HTMLResponse`, `PlainTextResponse` for different content types.
* `StreamingResponse` allows efficient **real-time or large data** delivery.
* `FileResponse` makes serving files (PDFs, CSVs, images) simple.
* You can dynamically **export CSV or other formats** for client downloads.

---
