# **Chapter 14: Integrating Databases**

### **Overview**

In this chapter, you‚Äôll learn how to connect your **Dash application** to a **database** ‚Äî such as **SQLite** or **MySQL** ‚Äî to fetch and display **live, dynamic data**.
This is an essential skill for building dashboards that reflect **real-world, constantly changing information**, such as hospital appointments, patient records, or sales reports.

---

### **Topics Covered**

1. Why connect Dash to a database?
2. Setting up a database connection
3. Fetching data dynamically
4. Displaying live data on the dashboard
5. Example: **Hospital Appointment Dashboard**

---

## **1. Why Connect Dash to a Database?**

Dash apps are highly interactive, but without a data source, they only show static information.
Connecting to a database allows you to:

* Display **live, real-time updates** (e.g., patient check-ins or appointments)
* Filter and search records dynamically
* Handle large datasets efficiently
* Build **data-driven dashboards** that reflect ongoing operations

---

## **2. Setting Up Database Connection**

You can use either **SQLite** (lightweight, file-based) or **MySQL** (server-based).
Let‚Äôs start with SQLite for simplicity, and then show how to adapt it for MySQL.

### **Using SQLite**

```python
import sqlite3

def get_connection():
    conn = sqlite3.connect("hospital.db")
    return conn
```

### **Using MySQL**

```python
import mysql.connector

def get_connection():
    conn = mysql.connector.connect(
        host="localhost",
        user="root",
        password="your_password",
        database="hospital_db"
    )
    return conn
```

---

## **3. Fetching Data from Database**

Let‚Äôs define a helper function to fetch appointment data.

```python
import pandas as pd

def fetch_appointments():
    conn = get_connection()
    query = "SELECT patient_name, doctor_name, department, date, time, status FROM appointments"
    df = pd.read_sql_query(query, conn)
    conn.close()
    return df
```

---

## **4. Displaying Live Data in Dash**

Now, integrate the database into a **Dash app**.

```python
from dash import Dash, html, dcc, dash_table, Input, Output
import pandas as pd
import sqlite3

app = Dash(__name__)

# Function to fetch data from SQLite
def get_connection():
    conn = sqlite3.connect("hospital.db")
    return conn

def fetch_appointments():
    conn = get_connection()
    query = "SELECT patient_name, doctor_name, department, date, time, status FROM appointments"
    df = pd.read_sql_query(query, conn)
    conn.close()
    return df

app.layout = html.Div([
    html.H2("üè• Hospital Appointment Dashboard"),
    dcc.Interval(
        id='interval-component',
        interval=10*1000,  # refresh every 10 seconds
        n_intervals=0
    ),
    dash_table.DataTable(
        id='appointment-table',
        columns=[{"name": i, "id": i} for i in ['patient_name', 'doctor_name', 'department', 'date', 'time', 'status']],
        style_table={'overflowX': 'auto'},
        style_cell={'textAlign': 'left'},
        style_header={'backgroundColor': '#007bff', 'color': 'white'}
    )
])

@app.callback(
    Output('appointment-table', 'data'),
    Input('interval-component', 'n_intervals')
)
def update_table(n):
    df = fetch_appointments()
    return df.to_dict('records')

if __name__ == '__main__':
    app.run_server(debug=True)
```

---

## **5. Example Walkthrough: Hospital Appointment Dashboard**

### **Scenario**

You are managing a hospital that handles **daily appointments** across multiple departments.
The goal is to build a dashboard that automatically refreshes and displays updated appointment information.

### **Steps**

1. Create an SQLite database called `hospital.db`.
2. Add a table named `appointments`.

Example SQL setup (run once in Python or DB Browser for SQLite):

```python
import sqlite3

conn = sqlite3.connect("hospital.db")
cursor = conn.cursor()

cursor.execute("""
CREATE TABLE IF NOT EXISTS appointments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    patient_name TEXT,
    doctor_name TEXT,
    department TEXT,
    date TEXT,
    time TEXT,
    status TEXT
)
""")

sample_data = [
    ("John Doe", "Dr. Smith", "Cardiology", "2025-10-05", "10:00 AM", "Confirmed"),
    ("Jane Roe", "Dr. Mehta", "Neurology", "2025-10-05", "11:00 AM", "Pending"),
    ("Alex Paul", "Dr. Singh", "Orthopedics", "2025-10-05", "12:30 PM", "Completed")
]

cursor.executemany("INSERT INTO appointments (patient_name, doctor_name, department, date, time, status) VALUES (?, ?, ?, ?, ?, ?)", sample_data)
conn.commit()
conn.close()
```

3. Run your Dash app ‚Äî the table updates every 10 seconds automatically.
4. Add new data into the database; the table refreshes dynamically.

---

## **6. Extending the Example**

You can enhance this dashboard by:

* Adding **filters** (date, department, doctor)
* Using **charts** to show the number of appointments by status
* Allowing users to **add or update appointments**
* Integrating with a **backend API** for multi-user access

---

### **Summary**

| Concept             | Description                            |
| ------------------- | -------------------------------------- |
| Database Connection | Connect Dash to SQLite/MySQL           |
| Data Fetching       | Query using SQL and load via pandas    |
| Live Updates        | Auto-refresh data using `dcc.Interval` |
| Example             | Hospital appointment dashboard         |
| Extension           | Filters, charts, CRUD operations       |

---

### ‚úÖ **Key Takeaway**

Dash apps can easily be connected to relational databases to fetch and display real-time data, enabling fully interactive dashboards that mirror ongoing activities ‚Äî such as hospital operations, sales systems, or IoT monitoring.

---
