# ðŸ§­ **Chapter 15: Authentication and Access Control**

### **15.1 Overview**

By default, Dash apps are open to everyone who can access the URL.
To make them secure and control access, we add **authentication** (login/logout) and **authorization** (restricting access to certain users or pages).

This chapter shows how to:

* Create a simple login system
* Store user session information
* Restrict access to dashboard pages until login
* Add a logout button to end the session

---

### **15.2 Concepts**

| Concept            | Description                                                |
| ------------------ | ---------------------------------------------------------- |
| **Authentication** | Verifying a userâ€™s identity (e.g., username/password).     |
| **Authorization**  | Granting access based on the authenticated userâ€™s role.    |
| **Session**        | Stores user info across multiple requests.                 |
| **Flask Session**  | Dash runs on Flask; we can use Flaskâ€™s session management. |

---

### **15.3 Adding Dependencies**

Install Dash and Flask extensions:

```bash
pip install dash Flask
```

---

### **15.4 Directory Structure**

```
auth_dash_app/
â”‚
â”œâ”€â”€ app.py                # Main Dash app
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ style.css         # Optional styling
```

---

### **15.5 Code Example â€“ Simple Login and Dashboard**

```python
# app.py
from dash import Dash, html, dcc, Input, Output, State
from flask import Flask, session
from dash.exceptions import PreventUpdate

# Initialize Flask server
server = Flask(__name__)
server.secret_key = "secret123"  # Required for session management

# Initialize Dash app
app = Dash(__name__, server=server, suppress_callback_exceptions=True)

# --- Layouts ---

# Login layout
login_layout = html.Div([
    html.H2("Login to Dashboard"),
    dcc.Input(id='username', type='text', placeholder='Username'),
    dcc.Input(id='password', type='password', placeholder='Password'),
    html.Button('Login', id='login-btn', n_clicks=0),
    html.Div(id='login-message', style={'marginTop': '10px', 'color': 'red'})
])

# Dashboard layout
dashboard_layout = html.Div([
    html.H2("Welcome to the Secure Dashboard!"),
    html.P("You are logged in."),
    html.Button('Logout', id='logout-btn', n_clicks=0)
])

# Main layout
app.layout = html.Div([
    dcc.Location(id='url'),
    html.Div(id='page-content')
])

# --- Callbacks ---

# Display page based on session status
@app.callback(
    Output('page-content', 'children'),
    Input('url', 'pathname')
)
def display_page(pathname):
    if 'logged_in' in session and session['logged_in']:
        return dashboard_layout
    else:
        return login_layout


# Handle login
@app.callback(
    Output('login-message', 'children'),
    Output('url', 'pathname', allow_duplicate=True),
    Input('login-btn', 'n_clicks'),
    State('username', 'value'),
    State('password', 'value'),
    prevent_initial_call='initial_duplicate'
)
def login(n_clicks, username, password):
    if n_clicks > 0:
        if username == "admin" and password == "password":
            session['logged_in'] = True
            return "", "/"
        else:
            return "Invalid credentials. Try again.", "/login"
    raise PreventUpdate


# Handle logout
@app.callback(
    Output('url', 'pathname', allow_duplicate=True),
    Input('logout-btn', 'n_clicks'),
    prevent_initial_call='initial_duplicate'
)
def logout(n_clicks):
    if n_clicks > 0:
        session['logged_in'] = False
        return "/login"
    raise PreventUpdate


if __name__ == "__main__":
    app.run_server(debug=True)
```

---

### **15.6 How It Works**

1. **Flask session** keeps track of whether a user is logged in.
2. When the app starts, the default layout (`login_layout`) is shown.
3. After login, session data is set:

   ```python
   session['logged_in'] = True
   ```
4. On next load, the app checks session state and shows the dashboard.
5. Clicking **Logout** resets the session and returns the user to the login page.

---

### **15.7 Adding a Role System (Optional)**

You can extend session data with user roles:

```python
session['user_role'] = 'admin'
```

Then check:

```python
if session.get('user_role') == 'admin':
    # Show admin features
```

---

### **15.8 Example Output**

#### Before Login

```
Login to Dashboard
[ Username: ____ ]
[ Password: ____ ]
[ Login Button ]
```

#### After Successful Login

```
Welcome to the Secure Dashboard!
You are logged in.
[ Logout Button ]
```

---

### **15.9 Best Practices**

* Never hardcode credentials (use a database or environment variables).
* Use HTTPS in production.
* Consider packages like `Flask-Login` or `Authlib` for robust systems.
* Limit session timeout for security.

---

### âœ… **Summary**

| Topic            | Key Idea                                              |
| ---------------- | ----------------------------------------------------- |
| Login            | Created with `dcc.Input` + session logic              |
| Logout           | Clears session and redirects                          |
| Route Protection | Conditional rendering based on `session['logged_in']` |
| Example          | Secure dashboard with restricted access               |

---

### **15.10 Next Steps**

In the next chapter, weâ€™ll add **user roles and database-based authentication**, connecting login credentials with an SQLite/MySQL table to manage real user data.

---

