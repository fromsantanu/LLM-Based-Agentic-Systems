# **Chapter 9: File Uploads and Downloads**

### **Overview**

Dash allows you to upload files (like CSV or Excel) directly through the browser and process them inside your app.
You can also provide download functionality for processed or generated data.

In this chapter, we‚Äôll cover:

* Uploading files using `dcc.Upload`
* Reading and processing uploaded files
* Displaying uploaded data in a table and chart
* Allowing users to download processed data

---

### **1. Uploading Files in Dash**

Dash provides the `dcc.Upload` component for file uploads.

#### **Example: Basic Upload Component**

```python
import dash
from dash import html, dcc

app = dash.Dash(__name__)

app.layout = html.Div([
    html.H2("Upload a CSV or Excel File"),
    dcc.Upload(
        id='upload-data',
        children=html.Div(['üìÇ Drag and Drop or ', html.A('Select Files')]),
        style={
            'width': '60%',
            'height': '60px',
            'lineHeight': '60px',
            'borderWidth': '2px',
            'borderStyle': 'dashed',
            'borderRadius': '10px',
            'textAlign': 'center',
            'margin': '20px auto'
        },
        multiple=False
    ),
    html.Div(id='file-info')
])

if __name__ == '__main__':
    app.run_server(debug=True)
```

‚úÖ **Explanation:**

* `dcc.Upload`: Creates an upload area for files.
* `multiple=False`: Restricts uploads to one file at a time.
* The file data will be sent as a **base64-encoded string** to your callback.

---

### **2. Processing Uploaded Data**

We‚Äôll now add a callback to decode and process the uploaded file.

```python
import dash
from dash import html, dcc, Input, Output
import pandas as pd
import io, base64

app = dash.Dash(__name__)

app.layout = html.Div([
    html.H2("Upload and View CSV/Excel Data"),
    dcc.Upload(
        id='upload-data',
        children=html.Div(['üìÇ Drag and Drop or ', html.A('Select File')]),
        style={
            'width': '60%', 'height': '60px', 'lineHeight': '60px',
            'borderWidth': '2px', 'borderStyle': 'dashed', 'borderRadius': '10px',
            'textAlign': 'center', 'margin': '20px auto'
        }
    ),
    html.Div(id='output-data-upload')
])

def parse_contents(contents, filename):
    content_type, content_string = contents.split(',')
    decoded = base64.b64decode(content_string)
    
    try:
        if 'csv' in filename:
            df = pd.read_csv(io.StringIO(decoded.decode('utf-8')))
        elif 'xls' in filename:
            df = pd.read_excel(io.BytesIO(decoded))
        else:
            return html.Div(["Unsupported file format."])
    except Exception as e:
        return html.Div([f"Error reading file: {e}"])
    
    # Display first few rows
    return html.Div([
        html.H5(filename),
        html.Hr(),
        html.H6("Preview:"),
        html.Div([
            html.Table([
                html.Thead(html.Tr([html.Th(col) for col in df.columns])),
                html.Tbody([
                    html.Tr([html.Td(df.iloc[i][col]) for col in df.columns])
                    for i in range(min(len(df), 5))
                ])
            ], style={'margin': '10px'})
        ]),
        html.Hr(),
        html.Div(f"Rows: {df.shape[0]} | Columns: {df.shape[1]}")
    ])

@app.callback(
    Output('output-data-upload', 'children'),
    Input('upload-data', 'contents'),
    Input('upload-data', 'filename')
)
def update_output(contents, filename):
    if contents is not None:
        return parse_contents(contents, filename)

if __name__ == '__main__':
    app.run_server(debug=True)
```

‚úÖ **Explanation:**

* Uploaded file content is base64-encoded, so we decode it.
* Depending on file type, `pd.read_csv` or `pd.read_excel` is used.
* The first few rows are displayed in a simple HTML table.

---

### **3. Displaying Summary Stats and Plot**

Let‚Äôs extend the previous example to show descriptive statistics and a chart.

```python
import dash
from dash import html, dcc, Input, Output
import pandas as pd
import io, base64, plotly.express as px

app = dash.Dash(__name__)

app.layout = html.Div([
    html.H2("Upload a Dataset and View Summary Stats"),
    dcc.Upload(
        id='upload-data',
        children=html.Div(['üìÇ Drag and Drop or ', html.A('Select File')]),
        style={
            'width': '60%', 'height': '60px', 'lineHeight': '60px',
            'borderWidth': '2px', 'borderStyle': 'dashed', 'borderRadius': '10px',
            'textAlign': 'center', 'margin': '20px auto'
        }
    ),
    html.Div(id='output-summary')
])

def parse_and_analyze(contents, filename):
    content_type, content_string = contents.split(',')
    decoded = base64.b64decode(content_string)
    
    try:
        if 'csv' in filename:
            df = pd.read_csv(io.StringIO(decoded.decode('utf-8')))
        elif 'xls' in filename:
            df = pd.read_excel(io.BytesIO(decoded))
        else:
            return html.Div(["Unsupported file format."])
    except Exception as e:
        return html.Div([f"Error: {e}"])
    
    summary = df.describe().reset_index()
    fig = px.histogram(df, x=df.columns[0], title=f"Distribution of {df.columns[0]}")

    return html.Div([
        html.H4(f"File: {filename}"),
        html.Hr(),
        html.H5("Summary Statistics"),
        dcc.Graph(figure=px.imshow(summary.set_index('index'), text_auto=True,
                                   title="Statistical Summary")),
        html.H5("Sample Data"),
        dcc.Graph(figure=fig)
    ])

@app.callback(
    Output('output-summary', 'children'),
    Input('upload-data', 'contents'),
    Input('upload-data', 'filename')
)
def update_output(contents, filename):
    if contents is not None:
        return parse_and_analyze(contents, filename)

if __name__ == '__main__':
    app.run_server(debug=True)
```

‚úÖ **Explanation:**

* `df.describe()` computes key summary statistics.
* `px.histogram()` shows the distribution of the first numeric column.
* Both charts and tables are displayed dynamically.

---

### **4. Adding File Download Option**

You can allow users to download processed or filtered data.

```python
from dash import Dash, html, dcc, Input, Output
import pandas as pd
import io, base64

app = Dash(__name__)

sample_df = pd.DataFrame({
    "Name": ["Alice", "Bob", "Charlie"],
    "Score": [85, 90, 78]
})

def generate_csv_download(df):
    csv_string = df.to_csv(index=False, encoding='utf-8')
    b64 = base64.b64encode(csv_string.encode()).decode()
    href = f'data:text/csv;base64,{b64}'
    return href

app.layout = html.Div([
    html.H2("Download Sample CSV"),
    html.A(
        "‚¨áÔ∏è Download Data",
        id='download-link',
        download="sample_data.csv",
        href=generate_csv_download(sample_df),
        target="_blank"
    )
])

if __name__ == '__main__':
    app.run_server(debug=True)
```

‚úÖ **Explanation:**

* We convert the DataFrame to a base64 string.
* The link downloads a ready CSV file directly.

---

### **5. Example Summary: Upload + Display + Download**

| Feature         | Dash Component            | Description                                   |
| --------------- | ------------------------- | --------------------------------------------- |
| File Upload     | `dcc.Upload`              | Drag-and-drop or browse to upload files       |
| File Processing | `pandas`, `base64`        | Decode and read file into DataFrame           |
| Data Display    | `html.Table`, `dcc.Graph` | Show data preview and visualizations          |
| File Download   | `html.A`                  | Generate downloadable CSV from processed data |

---

### ‚úÖ **Example Use Case: Upload a CSV, View Summary, and Download Filtered Data**

You can combine all the steps to build:

* Data analytics dashboards
* Quality control panels
* Data submission portals
* User-uploaded dataset visualizers

---
