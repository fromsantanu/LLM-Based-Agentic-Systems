# **Chapter 17: Case Study ‚Äî AI Health Assistant System**

---

## **17.1 Overview**

In this chapter, we‚Äôll build a **mini end-to-end AI Health Assistant System** ‚Äî a demonstration of how all the components (FastAPI, Database, LangServe, LangChain, and Streamlit) work together in a production-like workflow.

This case study models a **clinical assistant app** that supports doctors and diagnostic centers by:

* Managing **patient and test data** via FastAPI and Database
* Using **LangServe + LangChain** for **AI-driven diagnostic reasoning**
* Providing a **Streamlit interface** for clinicians to interact with the system
* Producing structured **AI recommendations and summaries**

---

## **17.2 System Architecture**

### **Core Components**

| Layer       | Technology                 | Role                                               |
| ----------- | -------------------------- | -------------------------------------------------- |
| Backend API | **FastAPI + SQLite/MySQL** | Patient/test CRUD, structured data interface       |
| AI Engine   | **LangServe + LangChain**  | Handles diagnostic reasoning chains                |
| Frontend UI | **Streamlit**              | Clinician dashboard for data input and AI insights |
| Middleware  | **Pydantic Models**        | Data validation and schema management              |
| Deployment  | **Uvicorn + Docker**       | Scalable and portable environment                  |

---

## **17.3 Workflow Overview**

```
[ Streamlit UI ] 
      ‚Üì (User Input)
[ FastAPI Server ] ‚Üê‚Üí [ Database ]
      ‚Üì (Patient/Test JSON)
[ LangServe API ] ‚Üí AI Reasoning ‚Üí Result
      ‚Üì
[ Streamlit Display ] ‚Üí Summary/Recommendation
```

**Pipeline:**

1. **Intake** ‚Äì Clinician enters patient info and test results
2. **Analysis** ‚Äì LangServe forwards structured data to LangChain diagnostic chain
3. **Recommendation** ‚Äì AI generates possible causes, flags, and treatment suggestions
4. **Summary** ‚Äì Clinician views structured report in Streamlit

---

## **17.4 Database and Models**

### **Database Schema**

We‚Äôll use SQLite for simplicity.

**Tables:**

* `patients`: stores demographic and medical info
* `tests`: stores test results linked to a patient

```python
# models.py
from sqlalchemy import Column, Integer, String, Float, ForeignKey, DateTime
from sqlalchemy.orm import relationship
from database import Base

class Patient(Base):
    __tablename__ = "patients"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String)
    age = Column(Integer)
    gender = Column(String)
    condition = Column(String, nullable=True)

    tests = relationship("Test", back_populates="patient")


class Test(Base):
    __tablename__ = "tests"
    id = Column(Integer, primary_key=True, index=True)
    patient_id = Column(Integer, ForeignKey("patients.id"))
    test_name = Column(String)
    result_value = Column(Float)
    normal_range = Column(String)
    date = Column(DateTime)

    patient = relationship("Patient", back_populates="tests")
```

---

## **17.5 FastAPI Backend**

### **Endpoints**

| Endpoint         | Method | Description                     |
| ---------------- | ------ | ------------------------------- |
| `/patients/`     | `POST` | Create new patient              |
| `/tests/`        | `POST` | Add test results                |
| `/patients/{id}` | `GET`  | Retrieve patient info           |
| `/analyze/{id}`  | `GET`  | Trigger AI diagnostic reasoning |

Example (simplified):

```python
# main.py
from fastapi import FastAPI
from routers import patients, tests
from langserve import add_routes
from ai_diagnosis_chain import diagnosis_chain

app = FastAPI(title="AI Health Assistant")

# Mount DB routes
app.include_router(patients.router)
app.include_router(tests.router)

# Mount LangServe route
add_routes(app, diagnosis_chain, path="/api/diagnose")

@app.get("/")
def root():
    return {"message": "AI Health Assistant API running"}
```

---

## **17.6 LangServe + LangChain Diagnostic Reasoning**

This is where the **AI engine** performs structured reasoning using LangChain.

```python
# ai_diagnosis_chain.py
from langchain.chat_models import ChatOpenAI
from langchain.prompts import ChatPromptTemplate
from langchain.schema import StrOutputParser
from langchain.chains import LLMChain

llm = ChatOpenAI(model="gpt-4o", temperature=0.2)

prompt = ChatPromptTemplate.from_template("""
Given the following patient and test data, generate a clinical summary and probable diagnosis.
Patient: {patient_name}, Age: {age}, Gender: {gender}
Test Results: {test_results}
Return structured output with:
- Possible conditions
- Recommendations
- Urgency flag
""")

diagnosis_chain = LLMChain(
    llm=llm,
    prompt=prompt,
    output_parser=StrOutputParser()
)
```

This chain is then exposed via LangServe as `/api/diagnose`.

---

## **17.7 Streamlit Frontend for Clinicians**

The clinician-facing dashboard allows:

* Patient lookup
* Test entry
* Trigger AI analysis
* Display summary and recommendations

```python
# app.py
import streamlit as st
import requests

st.title("üß† AI Health Assistant")

backend = "http://127.0.0.1:8000"

# Input patient ID
patient_id = st.text_input("Enter Patient ID:")

if st.button("Run AI Diagnosis"):
    response = requests.get(f"{backend}/analyze/{patient_id}")
    if response.status_code == 200:
        st.subheader("ü©∫ Diagnostic Summary")
        st.write(response.json())
    else:
        st.error("Failed to fetch analysis.")
```

This app communicates with FastAPI ‚Üí LangServe ‚Üí LangChain chain seamlessly.

---

## **17.8 Example Scenario**

### **Case:**

* **Patient:** Anita Das, 42, Female
* **Tests:**

  * Hemoglobin: 9.5 g/dL (Low)
  * MCV: 70 fL (Low)

**AI Output Example:**

```json
{
  "Possible Conditions": ["Iron Deficiency Anemia"],
  "Recommendations": ["Iron supplements", "Dietary changes (leafy greens, lentils)", "Follow-up in 4 weeks"],
  "Urgency": "Low to Moderate"
}
```

---

## **17.9 Enhancements and Next Steps**

| Enhancement               | Description                                         |
| ------------------------- | --------------------------------------------------- |
| üß© **Add Triage Agent**   | Use LangGraph to classify severity before diagnosis |
| üîê **Add Authentication** | Clinician login (OAuth2) via FastAPI                |
| üìä **Add Dashboard**      | Use Dash/Streamlit charts to visualize trends       |
| üß† **Expand Reasoning**   | Integrate retrieval from medical knowledge base     |
| üíæ **Data Persistence**   | Store AI outputs back in database for audit trail   |

---

## **17.10 Summary**

This chapter demonstrated how to **unify FastAPI, LangServe, LangChain, and Streamlit** into a real-world application ‚Äî the **AI Health Assistant System**.

You learned:

* How FastAPI handles structured medical data
* How LangServe exposes diagnostic reasoning as an API
* How Streamlit makes it accessible for clinicians
* How all components interact in a complete clinical workflow

---

