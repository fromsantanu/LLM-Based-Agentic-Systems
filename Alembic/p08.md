# **Lesson 8 (Optional): Advanced Use Cases**

### **1. Using Alembic in Multi-Database or Multi-App Environments**

In large applications, you might have **more than one database** â€” for example, one for users, another for analytics, or one per microservice.
Alembic can handle this too.

* Each database can have its own `alembic.ini` and `versions/` folder.
* You can also configure multiple engines inside `env.py`.
* When you run `alembic upgrade head`, you can tell Alembic which database to upgrade by giving it the right connection URL.

ðŸ’¡ **Tip:** Keep migrations organized by naming folders like `alembic_user/`, `alembic_orders/`, etc. to avoid confusion.

---

### **2. Seeding Initial Data Using Alembic Scripts**

Sometimes, you need to **insert starting data** right after a new table is created â€” for example, adding admin users, predefined roles, or lookup values.

You can add Python code directly inside your migration script under the `upgrade()` function:

```python
def upgrade():
    # Example: Insert default roles
    from sqlalchemy import table, column, String
    from alembic import op

    roles_table = table('roles', column('name', String))
    op.bulk_insert(roles_table, [
        {"name": "Admin"},
        {"name": "Doctor"},
        {"name": "Staff"},
    ])
```

And if needed, remove that data in `downgrade()`.

ðŸ’¡ **Note:** Avoid putting large data imports here; just use small seed data thatâ€™s needed for the system to start.

---

### **3. Alembic in CI/CD Pipelines (Automatic Migrations)**

In real-world deployment (like on GitHub Actions, Jenkins, or Docker), you may want **migrations to run automatically** whenever new code is deployed.

A simple process:

1. Developer pushes new code and Alembic migration scripts.
2. CI/CD pipeline detects the change.
3. Before starting the app, the pipeline runs:

   ```bash
   alembic upgrade head
   ```

   This ensures the database is updated to the latest version automatically.

ðŸ’¡ **Tip:** Always back up the database or run migrations on a staging environment first to test.

---

### âœ… **Summary**

* Alembic supports multiple databases and microservices.
* You can seed initial or default data safely within migrations.
* Automatic migrations in CI/CD make deployment smoother and consistent.

---

