# **Lesson 6: Managing Schema Versions**

---

### üìò Overview

Once you start using Alembic for database migrations, you‚Äôll often need to check which version of the schema your database is currently on, or move (upgrade/downgrade) to a specific version. This lesson explains how to manage schema versions safely and handle migration conflicts.

---

### üß© 1. Viewing Migration History

You can list all migrations (applied and unapplied) using the Alembic command:

```bash
alembic history
```

‚úÖ **Example Output:**

```
Revision ID: 8ac19e4d0ad2 -> 1d92b45a8c3d
Message: add users table
```

* Each revision has a unique ID.
* The ‚Äú->‚Äù arrow shows the migration order.
* The current database version is the latest one applied.

To check only the **current revision** applied to your database:

```bash
alembic current
```

---

### üîº 2. Upgrading to a Specific Revision

You can upgrade the database to the **latest revision** with:

```bash
alembic upgrade head
```

Or upgrade to a specific revision:

```bash
alembic upgrade <revision_id>
```

Example:

```bash
alembic upgrade 1d92b45a8c3d
```

This applies all migrations up to the specified revision.

---

### üîΩ 3. Downgrading to a Specific Revision

If you need to **revert** changes:

```bash
alembic downgrade <revision_id>
```

Example:

```bash
alembic downgrade 8ac19e4d0ad2
```

Or to undo the last migration only:

```bash
alembic downgrade -1
```

‚ö†Ô∏è **Be careful:** Downgrading will remove database objects (tables, columns, etc.) added after that version.

---

### ‚öñÔ∏è 4. Handling Migration Conflicts

Conflicts may happen if:

* Two developers create migrations independently.
* The same base revision is used in different branches.

Alembic detects this and shows an error like:

```
Branching point detected between revisions X and Y
```

ü©π **How to fix:**

1. Identify the conflicting heads:

   ```bash
   alembic heads
   ```
2. Merge them with:

   ```bash
   alembic merge -m "merge branches" <revision1> <revision2>
   ```
3. Then upgrade again:

   ```bash
   alembic upgrade head
   ```

---

### üí° 5. Summary

| Task                 | Command                                    | Description                    |
| -------------------- | ------------------------------------------ | ------------------------------ |
| Show all migrations  | `alembic history`                          | Lists revision history         |
| Show current version | `alembic current`                          | Shows current database version |
| Upgrade to latest    | `alembic upgrade head`                     | Applies all pending migrations |
| Downgrade one step   | `alembic downgrade -1`                     | Reverts last migration         |
| Merge branches       | `alembic merge -m "message" <rev1> <rev2>` | Resolves migration conflicts   |

---

