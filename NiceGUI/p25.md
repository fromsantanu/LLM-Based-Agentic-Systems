# **Lesson 25 â€” Tracking API Usage or Service Limits for Each User**

## â­ What you will learn in this lesson

In this lesson, you will learn how to keep track of **how many times each user has used your API or service**.

This is very useful when:

* You want to give **limited free usage** (example: â€œ50 calls per dayâ€)
* You want to prevent misuse
* You want to show the user how much they have used and how much is left
* You want to manage subscription plans

We will create a small NiceGUI page that:

* Shows a list of users
* Shows how many API calls each user made
* Updates automatically in real time

---

# ğŸ§  Real-life example

Imagine you run a clinic and provide an AI service to different doctors.

Each doctor may have a plan like:

* **Basic** â†’ 100 calls per month
* **Standard** â†’ 500 calls
* **Premium** â†’ unlimited

To manage this, you must track how many calls each doctor made so far.
This lesson teaches you how to build that basic dashboard.

---

# **Step-by-step: Letâ€™s build it**

We will *simulate* usage (randomly increasing the count), but the idea is the same as real usage from an API.

---

# âœ… Step 1: Install NiceGUI

```
pip install nicegui
```

---

# âœ… Step 2: Write the dashboard code

```python
from nicegui import ui
import random

# Example users with usage limits
users = {
    "doctor_1": {"used": 10, "limit": 50},
    "doctor_2": {"used": 25, "limit": 100},
    "doctor_3": {"used": 5, "limit": 20},
}

def update_usage(table):
    # simulate usage increase
    for data in users.values():
        data["used"] += random.choice([0, 1])  # sometimes increases by 1

        # make sure used never exceeds the limit
        if data["used"] > data["limit"]:
            data["used"] = data["limit"]

    # update table rows
    rows = [
        [name, data["used"], data["limit"]]
        for name, data in users.items()
    ]
    table.rows = rows

with ui.page("/"):
    ui.label("API Usage Tracker").classes("text-2xl")

    table = ui.table(
        columns=[
            {"name": "user", "label": "User", "field": "user"},
            {"name": "used", "label": "Used Calls", "field": "used"},
            {"name": "limit", "label": "Limit", "field": "limit"},
        ],
        rows=[
            [name, data["used"], data["limit"]]
            for name, data in users.items()
        ],
    )

    # refresh every 3 seconds
    ui.timer(interval=3.0, callback=lambda: update_usage(table))

ui.run()
```

---

# âœ¨ Explanation in very simple words

### **1. Importing tools**

```python
from nicegui import ui
import random
```

* `ui` â†’ builds the webpage
* `random` â†’ helps us simulate usage increasing

---

### **2. Creating some example users**

```python
users = {
    "doctor_1": {"used": 10, "limit": 50},
    "doctor_2": {"used": 25, "limit": 100},
    "doctor_3": {"used": 5,  "limit": 20},
}
```

* Each user has:

  * `used` â†’ how many API calls they have already used
  * `limit` â†’ maximum allowed

In real life, this data will come from your database.

---

### **3. Updating the usage**

```python
def update_usage(table):
    for data in users.values():
        data["used"] += random.choice([0, 1])
```

* This simulates API usage increasing
* Sometimes it increases; sometimes it stays the same

---

### **4. Showing the users in a table**

```python
table = ui.table(...)
```

A table is the simplest way to show:

* user name
* used calls
* limit

NiceGUI updates tables easily.

---

### **5. Real-time refresh**

```python
ui.timer(interval=3.0, callback=lambda: update_usage(table))
```

* Runs every **3 seconds**
* Updates the table
* Dashboard becomes **live and automatic**

---

### **6. Start the app**

```python
ui.run()
```

---

# ğŸš€ How to run and test the lesson

1. Save the file as **lesson25.py**
2. Open the folder in terminal
3. Run:

```
python lesson25.py
```

4. Open your browser and go to:

```
http://localhost:8080
```

You will see a live-updating table where usage increases over time.

---

# ğŸ’¡ Tips & Best Practices

### âœ” Tip 1 â€” Store real usage in a database

In real applications:

* every time an API is called
* you update the â€œusedâ€ value in your database
  This makes tracking reliable.

### âœ” Tip 2 â€” Stop users when they exceed their limit

Before executing your API logic:

* check if `used >= limit`
* if yes, show:
  **â€œYour monthly limit is over. Please upgrade your plan.â€**

---
