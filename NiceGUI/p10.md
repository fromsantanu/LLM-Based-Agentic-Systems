# **Lesson 10: Adding a Typing Animation or â€œAssistant is writingâ€¦â€ Indicator**

In this lesson, you will learn how to show a short message like:

**â€œAssistant is typingâ€¦â€**

This makes your chatbot feel much more naturalâ€”just like WhatsApp, Messenger, or any modern chat app.

---

## ğŸ§  Real-life picture

Imagine you are talking to a friend through SMS.

You send a message.
For a moment you see:

**â€œTypingâ€¦â€**

You know your friend is replying, so you wait.

We will add the same feeling to your chatbot.

---

# â­ What we will do

When the user presses **Send**:

1. Show â€œAssistant is typingâ€¦â€ in the chat window
2. Call the FastAPI backend
3. When the backend reply arrives â†’ remove the typing message
4. Add the real AI reply

This gives a smooth user experience.

---

# â­ PART A â€” NiceGUI with a typing indicator

We will modify the frontend (NiceGUI).

---

## ğŸ’» Code: NiceGUI frontend with typing indicator

Create file: **chat_frontend_typing.py**

```python
from nicegui import ui
import requests
import asyncio  # used for small delays

BACKEND_URL = "http://localhost:8000/chat"

# session-based chat history
ui.session_state.setdefault("chat_history", [])

async def send_message():
    user_text = input_box.value

    if not user_text.strip():
        return

    # add user message
    ui.session_state.chat_history.append(
        {"role": "user", "content": user_text}
    )

    # show user message immediately
    refresh_chat()

    # clear input
    input_box.value = ""

    # show typing indicator
    typing_label = ui.label("Assistant is typing...").classes('text-gray-500 italic')
    await asyncio.sleep(0.1)  # allow UI to update

    # call FastAPI backend
    try:
        response = requests.post(
            BACKEND_URL,
            json={"history": ui.session_state.chat_history},
            timeout=15
        )
        response.raise_for_status()
        data = response.json()
        bot_reply = data.get("reply", "No reply from backend.")
    except Exception as e:
        bot_reply = f"Error: {e}"

    # remove typing label
    typing_label.delete()

    # add assistant message
    ui.session_state.chat_history.append(
        {"role": "assistant", "content": bot_reply}
    )

    # refresh chat
    refresh_chat()


def refresh_chat():
    chat_area.clear()
    for msg in ui.session_state.chat_history:
        text = f"{msg['role'].capitalize()}: {msg['content']}"
        ui.label(text, parent=chat_area)


with ui.column().classes('w-1/2 q-pa-md'):
    ui.label('Chat with Typing Indicator').classes('text-h5')

    chat_area = ui.column().classes(
        'border rounded p-4 h-64 overflow-y-auto bg-white'
    )

    with ui.row().classes('w-full items-center q-pt-md'):
        input_box = ui.input(
            placeholder='Type your message...'
        ).classes('w-full')

        # note: send_message is async, so we use ui.button(..., on_click=...)
        ui.button('Send', on_click=send_message)

ui.run()
```

---

# ğŸ§¾ Explanation (frontend)

### `async def send_message():`

We make the function **async**, meaning it can:

* wait
* show animations
* update UI smoothly

---

### Showing the typing indicator:

```python
typing_label = ui.label("Assistant is typing...")
```

This adds a temporary message below the user message.

We also add some styling:

* `text-gray-500` â†’ faded grey color
* `italic` â†’ looks like a hint

---

### Allow UI to update:

```python
await asyncio.sleep(0.1)
```

This tiny delay lets the browser refresh properly before calling the backend.

---

### Remove the indicator:

```python
typing_label.delete()
```

This cleans up the UI when the real AI reply arrives.

---

### `refresh_chat()`

A helper function that reprints the full conversation.

---

# â­ PART B â€” Backend stays the same!

You can keep using the previous backend:

* `backend_chat_context.py`
* or `backend_chat_ai.py`

Nothing needs to change in the backend.

The frontend alone controls the typing animation.

---

# â–¶ï¸ How to run it

1. Start backend (FastAPI):

```bash
uvicorn backend_chat_context:app --reload
```

2. Start frontend (NiceGUI):

```bash
python chat_frontend_typing.py
```

3. Open browser:

```
http://localhost:8080
```

Type:

> â€œHello!â€

You will instantly see:

```
User: Hello!
Assistant is typing...
```

Then a moment later:

```
Assistant: <AI reply>
```

This feels much smoother and more human-like.

---

# ğŸ’¡ Tips & Best Practices

### âœ” Tip 1 â€” Add a tiny random delay

You can make typing more realistic by adding:

```python
await asyncio.sleep(0.3)
```

Feels like the bot is â€œthinkingâ€.

---

### âœ” Tip 2 â€” Add animated dots

Instead of static text, you can update label every 0.5 seconds:

* â€œtyping.â€
* â€œtyping..â€
* â€œtyping...â€

We can do this in a future lesson if you want.

---

### âœ” Tip 3 â€” Hide the indicator if errors occur

Your code already does this by deleting the label even if backend fails.

---

# ğŸ‰ Summary

In this lesson you learned:

* how to make your chatbot show a short â€œassistant is typingâ€ animation
* how async functions help display progress smoothly
* how to control UI updates using NiceGUI
* how to make the chat experience feel more real and alive

Your chatbot now feels **interactive**, not robotic.

---



