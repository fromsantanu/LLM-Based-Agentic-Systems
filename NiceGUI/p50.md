# **Lesson 50: Building a Customer-Support Dashboard with Conversation Logs**

In this lesson, you will build a simple **customer-support dashboard** using NiceGUI.
Think of this like a small internal tool a company uses to see:

* List of customers
* Their conversation history
* A chat box so the support agent can reply
* A simple way to store and show old messages

We will keep everything **in memory** (just Python lists) so you can understand the idea easily.
Later you can replace it with real **FastAPI + database**.

---

# **1. What You Will Build**

The screen will have two main parts:

### **Left panel**

* List of customers
* When you click a customer, you see their conversations

### **Right panel**

* Chat area (show previous messages)
* Input box to type reply
* “Send Reply” button
* “Close Ticket” button (demo)

This looks like a small customer-support agent dashboard.

---

# **2. Full Working Code (Single File)**

Save as **support_dashboard.py**:

```python
from nicegui import ui

# -----------------------------
# Dummy data (stored in memory)
# -----------------------------

customers = [
    {'id': 1, 'name': 'Ravi Kumar', 'email': 'ravi@example.com'},
    {'id': 2, 'name': 'Meera Singh', 'email': 'meera@example.com'},
    {'id': 3, 'name': 'John Carter', 'email': 'john@example.com'},
]

# Each customer has conversation logs
conversation_logs = {
    1: [
        {'sender': 'Customer', 'text': 'Hi, I have a billing issue.'},
        {'sender': 'Support', 'text': 'Sure, can you explain the issue?'},
    ],
    2: [
        {'sender': 'Customer', 'text': 'My order is delayed.'},
        {'sender': 'Support', 'text': 'Let me check that for you.'},
    ],
    3: [
        {'sender': 'Customer', 'text': 'I want to change my password.'},
    ]
}


# -----------------------------
# Main Page
# -----------------------------

@ui.page('/')
def support_dashboard():

    ui.label('Customer Support Dashboard').classes('text-2xl font-bold mb-4')

    # Main row layout: left list + right chat
    with ui.row().classes('w-full h-screen'):

        # ---------------- Left: Customer List ----------------
        with ui.column().classes('w-1/4 border-r p-3'):
            ui.label('Customers').classes('text-lg font-semibold')

            customer_list = ui.column().classes('mt-2')

            selected_customer_id = ui.store(None)

            def load_customer_chat(customer_id):
                selected_customer_id.set(customer_id)
                refresh_chat()

            # Populate customer names
            for c in customers:
                ui.button(
                    f"{c['name']} ({c['email']})",
                    on_click=lambda e, cid=c['id']: load_customer_chat(cid),
                ).classes('w-full mb-1')

        # ---------------- Right: Chat Panel ----------------
        with ui.column().classes('w-3/4 p-4'):

            ui.label('Conversation Log').classes('text-lg font-semibold')

            chat_box = ui.column().classes(
                'border rounded p-3 mt-2 w-full h-[70vh] overflow-y-auto bg-gray-100'
            )

            # Function to refresh chat messages
            def refresh_chat():
                chat_box.clear()
                cid = selected_customer_id.value
                if not cid:
                    chat_box.add(ui.label('Select a customer from the left panel.'))
                    return

                logs = conversation_logs.get(cid, [])

                for m in logs:
                    ui.chat_message(
                        m['text'],
                        name=m['sender'],
                        sent=(m['sender'] == 'Support')
                    )

            # Input area to send message
            reply_input = ui.input(
                'Type your reply...'
            ).props('type=textarea autogrow').classes('w-full mt-3')

            # Send reply button
            def send_reply():
                cid = selected_customer_id.value
                if not cid:
                    ui.notify('Please select a customer first.')
                    return

                message = reply_input.value.strip()
                if not message:
                    ui.notify('Please type a message.')
                    return

                # Add support message to logs
                conversation_logs[cid].append({'sender': 'Support', 'text': message})
                reply_input.value = ''
                refresh_chat()
                ui.notify('Reply sent.')

            ui.button('Send Reply', on_click=send_reply).classes('mt-2')

            # Close ticket button (demo only)
            def close_ticket():
                cid = selected_customer_id.value
                if not cid:
                    ui.notify('Select a customer first.')
                    return

                conversation_logs[cid].append(
                    {'sender': 'Support', 'text': 'Ticket closed. Let us know if you need anything else.'}
                )
                refresh_chat()
                ui.notify('Ticket closed.')

            ui.button('Close Ticket', on_click=close_ticket).classes('mt-2')


# -----------------------------
# Run the app
# -----------------------------

ui.run(title='Support Dashboard')
```

---

# **3. Explanation in Simple Words**

Let's break it into small parts.

---

## **a) Dummy customer data**

```python
customers = [...]
```

Think of this like a mini customer table.

```python
conversation_logs = { 1: [...], 2: [...], ... }
```

Each customer has a list of messages.

---

## **b) Left Panel (Customer List)**

* It shows all customers.
* When you click a name:

  * We store the `customer_id`
  * We call `refresh_chat()`

---

## **c) Right Panel (Chat Area)**

* A big container (`chat_box`) that shows old messages.
* Messages are shown using:

```python
ui.chat_message(...)
```

* Support messages appear on the right.
* Customer messages appear on the left.

---

## **d) Typing a Reply**

When support agent types a message and clicks **Send Reply**:

1. We get the selected customer
2. We add the new message to conversation log
3. We refresh the chat box to show it
4. Clear the input

---

## **e) Closing a Ticket**

It simply adds:

```
Ticket closed. Let us know if you need anything else.
```

to the chat.

---

# **4. How to Run**

1. Install NiceGUI (if not installed):

```bash
pip install nicegui
```

2. Save as:

```
support_dashboard.py
```

3. Run the program:

```bash
python support_dashboard.py
```

4. Open browser:

```
http://localhost:8080
```

---

# **5. Small Useful Tips**

### **Tip 1: Connect to real API**

Replace:

```python
conversation_logs[customer_id]
```

with API calls to your backend:

* Fetch chat logs
* Send chat replies
* Update ticket status

---

### **Tip 2: Add filtering**

On the left:

* Show “Open tickets”
* Show “Closed tickets”
* Search by customer name

---

### **Tip 3: Add roles**

Different access for:

* Support agent
* Supervisor
* Admin

---


