# **Lesson 18: Saving Form Data to FastAPI + Database**

### **What you will learn**

In this lesson, you will learn how a NiceGUI form can send information to a **FastAPI backend**, and how that backend can **save the data into a database** (using SQLite for simplicity).

Think of this like a **reception desk** in a clinic:
The receptionist (NiceGUI) collects your details → passes them to the office staff (FastAPI) → they store them safely in a register (database).

We will build exactly this flow.

---

# **Real-life example**

Imagine you fill a simple registration form:

* Name
* Age
* City

When you click **Submit**, the information goes to a FastAPI server, and the server stores it in a small database table called `patients`.

---

# **Structure we will build**

```
project/
│
├── frontend.py     (NiceGUI form)
└── backend.py      (FastAPI API + Database)
```

You will run **backend.py first**, then **frontend.py**.

---

# ------------------------------------

# **PART 1 — FastAPI Backend**

# ------------------------------------

## **Step-by-step explanation (FastAPI)**

1. Create a database (SQLite file)
2. Create a table named `patients`
3. Make one FastAPI endpoint `/save`
4. When NiceGUI sends data, save it into the table

---

# **backend.py (FastAPI + SQLite)**

```python
from fastapi import FastAPI
from pydantic import BaseModel
import sqlite3

app = FastAPI()

# Create database + table if not exist
conn = sqlite3.connect('patients.db', check_same_thread=False)
cursor = conn.cursor()
cursor.execute('''
CREATE TABLE IF NOT EXISTS patients (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT,
    age INTEGER,
    city TEXT
)
''')
conn.commit()

# Data model for incoming request
class Patient(BaseModel):
    name: str
    age: int
    city: str

@app.post('/save')
def save_patient(data: Patient):
    cursor.execute(
        "INSERT INTO patients (name, age, city) VALUES (?, ?, ?)",
        (data.name, data.age, data.city)
    )
    conn.commit()
    return {"message": "Data saved successfully"}
```

---

# **Explanation (in simple words)**

* `FastAPI()` → creates the backend server
* SQLite database (`patients.db`) → simple file where data is stored
* Table `patients` → has name, age, city
* `Patient(BaseModel)` → describes what data we want
* `/save` endpoint → receives data and stores it in the database

This is the “office staff” that receives data from the form.

---

# ------------------------------------

# **PART 2 — NiceGUI Frontend**

# ------------------------------------

## **Step-by-step explanation (NiceGUI)**

1. Create simple form fields
2. When user clicks **Submit**, send data to FastAPI using `ui.run_javascript()` or `requests`
3. Show success message

We will use Python’s `requests` package for clarity.

---

# **frontend.py (NiceGUI Form)**

```python
from nicegui import ui
import requests

ui.label('Patient Registration Form').classes('text-h5')

name = ui.input('Enter your name')
age = ui.input('Enter your age')
city = ui.input('Enter your city')

def submit():
    # Prepare data for API
    data = {
        "name": name.value,
        "age": int(age.value),
        "city": city.value,
    }

    # Send to FastAPI backend
    response = requests.post("http://localhost:8000/save", json=data)

    if response.status_code == 200:
        ui.notify('Data saved successfully!', color='green')
    else:
        ui.notify('Error saving data', color='red')

ui.button('Submit', on_click=submit)

ui.run()
```

---

# **Line-by-line explanation (very simple)**

* `ui.input()` → boxes to type name, age, city
* `submit()` → called when button is clicked
* `data = {...}` → collects form values
* `requests.post()` → sends data to FastAPI
* If FastAPI says “OK”, NiceGUI shows a green success message
* `ui.run()` → starts the web app

---

# **How to run this whole system**

### **Step 1: Start the FastAPI backend**

Open a terminal and run:

```
uvicorn backend:app --reload
```

Backend now runs at:

[http://localhost:8000](http://localhost:8000)

### **Step 2: Start the NiceGUI frontend**

Open a second terminal and run:

```
python frontend.py
```

Your browser will open automatically.

Fill the form → click **Submit** → data is stored in `patients.db`.

---

# **Checking the database (optional)**

You can see stored data by opening SQLite manually:

```
sqlite3 patients.db
SELECT * FROM patients;
```

---

# **Tips & Best Practices**

### ⭐ Tip 1: Always validate your data

FastAPI helps you ensure correct types (age must be an integer).

### ⭐ Tip 2: Keep backend and frontend separate

It makes your project clean and easier to maintain.

---
