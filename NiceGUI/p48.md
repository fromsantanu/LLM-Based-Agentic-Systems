# Lesson 48: Building a Complete **AI Doctor Clinic App UI** with NiceGUI

*(Chat + Forms + Dashboard + Prescription Pages)*

In this lesson, you’ll build a small **clinic app UI** with four main parts:

1. **Dashboard** – small summary cards + a simple table
2. **Chat with AI Doctor** – chat-style interface
3. **Patient Form** – form to register/record basic details
4. **Prescription Page** – simple list of prescriptions

We’ll keep everything in **one file**, using **tabs** on the left as navigation.

Imagine it like a small clinic front desk screen:

* Left: menu (Dashboard, Chat, Patient Form, Prescriptions)
* Right: content area which changes when you click a menu item.

---

## 1. Full Example Code (Single File)

Save this as `clinic_app.py`:

```python
from nicegui import ui

# ---------------------------
# Simple in-memory data
# ---------------------------

# Just some sample data to show on the dashboard and prescription page
sample_patients = [
    {'name': 'Ravi', 'age': 45, 'last_visit': '2025-11-10'},
    {'name': 'Meera', 'age': 32, 'last_visit': '2025-11-12'},
]

sample_prescriptions = [
    {'patient': 'Ravi', 'drug': 'Metformin', 'dose': '500 mg', 'remarks': 'After meals'},
    {'patient': 'Meera', 'drug': 'Omeprazole', 'dose': '20 mg', 'remarks': 'Before breakfast'},
]

chat_history = []  # list of {'sender': 'Doctor'/'AI', 'text': '...'}


def fake_ai_reply(message: str) -> str:
    """Very simple dummy AI reply."""
    return f"I'm your AI doctor. You said: '{message}'. I will analyze this and suggest possibilities."


# ---------------------------
# Main page
# ---------------------------

@ui.page('/')
def clinic_app() -> None:
    # ---- Top header bar ----
    with ui.header().classes('bg-blue-700 text-white'):
        ui.label('AI Doctor Clinic').classes('text-xl font-bold')
        ui.space()
        ui.label('Demo UI (NiceGUI)')

    # ---- Main layout: left menu + right content ----
    with ui.row().classes('w-full h-screen'):
        # LEFT: vertical tab menu
        with ui.column().classes('w-1/5 bg-gray-100 h-full p-4'):
            ui.label('Navigation').classes('font-semibold mb-2')

            with ui.tabs().props('vertical').classes('w-full') as tabs:
                ui.tab('dashboard', label='Dashboard', icon='dashboard')
                ui.tab('chat', label='Chat', icon='chat')
                ui.tab('form', label='Patient Form', icon='assignment')
                ui.tab('prescriptions', label='Prescriptions', icon='medical_information')

        # RIGHT: content area
        with ui.tab_panels(tabs, value='dashboard').classes('w-4/5 h-full p-4'):
            # ---------------- Dashboard Panel ----------------
            with ui.tab_panel('dashboard'):
                ui.label('Clinic Dashboard').classes('text-lg font-bold mb-4')

                with ui.row().classes('w-full mb-4'):
                    # Simple cards to show summary
                    with ui.card().classes('p-4'):
                        ui.label('Total Patients')
                        ui.label(str(len(sample_patients))).classes('text-2xl font-bold')

                    with ui.card().classes('p-4'):
                        ui.label('Today\'s Appointments')
                        ui.label('5').classes('text-2xl font-bold')

                    with ui.card().classes('p-4'):
                        ui.label('Pending Prescriptions')
                        ui.label(str(len(sample_prescriptions))).classes('text-2xl font-bold')

                ui.label('Recent Patients').classes('font-semibold mb-2')
                ui.table(
                    columns=[
                        {'name': 'name', 'label': 'Name', 'field': 'name'},
                        {'name': 'age', 'label': 'Age', 'field': 'age'},
                        {'name': 'last_visit', 'label': 'Last Visit', 'field': 'last_visit'},
                    ],
                    rows=sample_patients,
                ).classes('w-full')

            # ---------------- Chat Panel ----------------
            with ui.tab_panel('chat'):
                ui.label('AI Doctor Chat').classes('text-lg font-bold mb-4')

                chat_container = ui.column().classes(
                    'border rounded p-3 mb-3 w-full h-80 overflow-y-auto'
                )

                # function to refresh the chat area
                def refresh_chat():
                    chat_container.clear()
                    for msg in chat_history:
                        ui.chat_message(
                            msg['text'],
                            name=msg['sender'],
                            sent=(msg['sender'] == 'Doctor'),
                        )

                # message input + send button
                doctor_input = ui.input('Type your message to AI doctor...').classes('w-3/4')

                def send_message():
                    text = doctor_input.value.strip()
                    if not text:
                        ui.notify('Please type a message first.')
                        return

                    # Add doctor message
                    chat_history.append({'sender': 'Doctor', 'text': text})

                    # Get AI reply (dummy)
                    reply = fake_ai_reply(text)
                    chat_history.append({'sender': 'AI', 'text': reply})

                    doctor_input.value = ''
                    refresh_chat()

                ui.button('Send', on_click=send_message).classes('ml-2')
                ui.button('Clear Chat', on_click=lambda: (chat_history.clear(), chat_container.clear())
                          ).classes('ml-2')

            # ---------------- Patient Form Panel ----------------
            with ui.tab_panel('form'):
                ui.label('Patient Form').classes('text-lg font-bold mb-4')

                name_input = ui.input('Patient Name').classes('w-1/2')
                age_input = ui.input('Age', type='number').classes('w-1/4')
                gender_input = ui.select(['Male', 'Female', 'Other'], label='Gender').classes('w-1/4')
                location_input = ui.input('Location / City').classes('w-1/2')
                symptoms_input = ui.textarea('Main Complaints / Symptoms').classes('w-2/3')

                def save_patient():
                    # In real app, you would call your API here
                    patient = {
                        'name': name_input.value,
                        'age': age_input.value,
                        'last_visit': '2025-11-14',  # just a dummy date
                    }
                    sample_patients.append(patient)
                    ui.notify(f'Patient {patient["name"]} saved (dummy).')
                    # clear fields
                    name_input.value = ''
                    age_input.value = ''
                    gender_input.value = None
                    location_input.value = ''
                    symptoms_input.value = ''

                ui.button('Save Patient (demo)', on_click=save_patient).classes('mt-2')

            # ---------------- Prescription Panel ----------------
            with ui.tab_panel('prescriptions'):
                ui.label('Prescriptions').classes('text-lg font-bold mb-4')

                ui.table(
                    columns=[
                        {'name': 'patient', 'label': 'Patient', 'field': 'patient'},
                        {'name': 'drug', 'label': 'Drug', 'field': 'drug'},
                        {'name': 'dose', 'label': 'Dose', 'field': 'dose'},
                        {'name': 'remarks', 'label': 'Remarks', 'field': 'remarks'},
                    ],
                    rows=sample_prescriptions,
                ).classes('w-full mb-4')

                # Small form to add a new prescription (demo only)
                ui.label('Add Prescription (demo)').classes('font-semibold mb-2')
                p_patient = ui.input('Patient Name').classes('w-1/4')
                p_drug = ui.input('Drug Name').classes('w-1/4')
                p_dose = ui.input('Dose (e.g., 500 mg)').classes('w-1/4')
                p_remarks = ui.input('Remarks').classes('w-1/3')

                def add_prescription():
                    presc = {
                        'patient': p_patient.value,
                        'drug': p_drug.value,
                        'dose': p_dose.value,
                        'remarks': p_remarks.value,
                    }
                    sample_prescriptions.append(presc)
                    ui.notify(f'Prescription for {presc["patient"]} added (demo).')
                    # clear fields
                    p_patient.value = ''
                    p_drug.value = ''
                    p_dose.value = ''
                    p_remarks.value = ''

                ui.button('Add Prescription', on_click=add_prescription).classes('mt-2')


# ---------------------------
# Run the app
# ---------------------------

ui.run(title='AI Doctor Clinic')
```

---

## 2. What Each Part Does (In Simple Words)

Think of this file like a small clinic office:

### a) Sample data section

* `sample_patients` and `sample_prescriptions` are just **dummy lists**.
* They act like a temporary mini-database **in memory**.
* `chat_history` stores the messages exchanged in the chat box.

`fake_ai_reply()` is a fake AI function.
Later, you can replace it with a real **FastAPI + OpenAI** call.

---

### b) `@ui.page('/')` – the main screen

Inside `clinic_app()`:

1. **Header bar**

   * Shows the app title `AI Doctor Clinic`.
   * Simple top bar with blue background.

2. **Main row layout**

   * Left: Column for **navigation tabs**
   * Right: Content area using **tab panels**

3. **Tabs on the left**

   * `Dashboard`
   * `Chat`
   * `Patient Form`
   * `Prescriptions`
     When you click one, the right side changes.

4. **Dashboard panel**

   * Shows three **cards**: total patients, today’s appointments, pending prescriptions.
   * A table listing `sample_patients`.

5. **Chat panel**

   * A scrollable column (`chat_container`) to display messages.
   * A text input for the doctor to type.
   * `Send` button:

     * Adds the doctor message to `chat_history`.
     * Calls `fake_ai_reply()`.
     * Adds AI reply to `chat_history`.
     * Refreshes the visible messages using `refresh_chat()`.
   * `Clear Chat` button:

     * Clears history and the visible chat area.

6. **Patient Form panel**

   * Inputs for:

     * Name, Age, Gender, Location, Symptoms
   * `Save Patient (demo)` button:

     * Creates a new mini patient record.
     * Appends it to `sample_patients`.
     * Shows a small notification.
     * Clears the form fields.
   * In a real system, here you would call your **FastAPI patient API**.

7. **Prescriptions panel**

   * Shows a table of `sample_prescriptions`.
   * A small form to add a new prescription in demo mode.
   * Again, in real life this would call your **prescription API**.

8. `ui.run(title='AI Doctor Clinic')`

   * Starts the NiceGUI server.
   * Opens the UI in your browser.

---

## 3. How to Run and Test

1. Install NiceGUI (if not already):

```bash
pip install nicegui
```

2. Save the file as:

```text
clinic_app.py
```

3. Run:

```bash
python clinic_app.py
```

4. Open your browser and go to:

```text
http://localhost:8080
```

You should see:

* A blue header at the top
* A left-side menu with 4 items
* Right side showing the selected page

Try:

* Add a patient in **Patient Form**, then check **Dashboard → Recent Patients**.
* Type a message in **Chat**; see dummy AI replies.
* Add a prescription and see it appear in the table.

---

## 4. Small Tips / Next Steps

1. **Connect to real APIs**

   * Replace `fake_ai_reply()` with a function that calls your **FastAPI + OpenAI** backend.

2. **Use real database**

   * Instead of `sample_patients` and `sample_prescriptions` lists, call API endpoints that read/write from **MySQL / PostgreSQL**.

3. **Split into files later**

   * For a bigger project, move:

     * Dashboard UI → `dashboard_ui.py`
     * Chat UI → `chat_ui.py`
     * Patient form UI → `patient_form_ui.py`
     * Prescription UI → `prescription_ui.py`

