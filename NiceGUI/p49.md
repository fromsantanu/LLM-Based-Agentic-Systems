# Lesson 49: Building a General-Purpose Chatbot Interface (Like ChatGPT)

In this lesson, you‚Äôll build a **simple chatbot UI** that feels a bit like ChatGPT:

* A **chat area** that shows messages as bubbles
* A **text box** where the user types
* A **Send** button (and press Enter to send)
* A place where we can later plug in any **LLM / API**

We‚Äôll first use a **dummy reply function** (no real AI), so that you can clearly see how the UI works. Later you can replace that function with your **FastAPI + OpenAI** endpoint.

---

## 1. Full Example Code (Single File)

Save this as `chatbot_app.py`:

```python
from nicegui import ui

# ---------------------------
# In-memory chat storage
# ---------------------------

chat_history = []  # each item: {'sender': 'User' or 'Bot', 'text': '...'}


def fake_bot_reply(message: str) -> str:
    """Simple dummy reply to simulate a chatbot."""
    return f"You said: '{message}'. I'm a demo bot. In real app, I would call an AI model here."


# ---------------------------
# Main page
# ---------------------------

@ui.page('/')
def chatbot_page() -> None:

    # ---- Header like ChatGPT ----
    with ui.header().classes('bg-blue-700 text-white'):
        ui.label('My Chatbot').classes('text-xl font-bold')
        ui.space()
        ui.label('Demo UI with NiceGUI')

    # ---- Main layout: center column ----
    with ui.column().classes('w-full items-center p-4'):
        ui.label('Chat with the Bot').classes('text-lg font-bold mb-2')

        # Chat container: scrollable area for messages
        chat_container = ui.column().classes(
            'border rounded w-full max-w-3xl h-[70vh] p-3 overflow-y-auto bg-gray-50'
        )

        # function to redraw chat messages
        def refresh_chat():
            chat_container.clear()
            for msg in chat_history:
                ui.chat_message(
                    msg['text'],
                    name=msg['sender'],
                    sent=(msg['sender'] == 'User'),
                )

        # ---- Input area (bottom) ----
        with ui.row().classes('w-full max-w-3xl mt-3 items-center'):
            user_input = ui.input(
                placeholder='Type your message...'
            ).classes('w-full').props('type=textarea autogrow')

            send_button = ui.button('Send')

        # ---- Logic to send message ----
        async def handle_send():
            text = (user_input.value or '').strip()
            if not text:
                ui.notify('Please type something.')
                return

            # Add user message
            chat_history.append({'sender': 'User', 'text': text})
            user_input.value = ''
            refresh_chat()

            # Show a small "thinking" indicator
            thinking = ui.spinner(size='md').classes('mt-2')
            ui.update()

            # Get bot reply (dummy for now)
            reply = fake_bot_reply(text)

            # Remove spinner and add bot message
            thinking.delete()
            chat_history.append({'sender': 'Bot', 'text': reply})
            refresh_chat()

        # When button is clicked
        send_button.on('click', lambda e: ui.run_javascript('', handle_send()))

        # Allow pressing Enter (Ctrl+Enter to add new line idea simplified: basic enter sends)
        @user_input.on('keydown.enter')
        async def _enter_key(event):
            # Prevent line break and send
            await handle_send()

        # Initial welcome message
        chat_history.append({'sender': 'Bot', 'text': 'Hi, I am your demo chatbot. How can I help you today?'})
        refresh_chat()


# ---------------------------
# Run the app
# ---------------------------

ui.run(title='Chatbot Demo')
```

---

## 2. Understanding the Code (Step by Step)

Think of this app like chatting with a friend on WhatsApp:

* **Messages** go into a list (`chat_history`).
* We **redraw** the chat area each time a new message comes.

### a) `chat_history` and `fake_bot_reply`

```python
chat_history = []
```

* This is just a Python list.
* Every time someone chats, we add a small dictionary:

  * `{'sender': 'User', 'text': 'Hello'}`
  * `{'sender': 'Bot', 'text': 'Hi there'}`

```python
def fake_bot_reply(message: str) -> str:
    return f"You said: '{message}'. I'm a demo bot..."
```

* This is only a **placeholder**.
* Later, you can replace this with a real call to:

  * FastAPI endpoint
  * OpenAI, DeepSeek, etc.

---

### b) Header

```python
with ui.header().classes('bg-blue-700 text-white'):
    ui.label('My Chatbot').classes('text-xl font-bold')
    ui.space()
    ui.label('Demo UI with NiceGUI')
```

* This creates a bar at the top, like an app title bar.

---

### c) Chat container

```python
chat_container = ui.column().classes(
    'border rounded w-full max-w-3xl h-[70vh] p-3 overflow-y-auto bg-gray-50'
)
```

* A vertical stack (`column`) that:

  * Has border
  * Has fixed height
  * Can scroll (`overflow-y-auto`)
* This is where we show all the **chat bubbles**.

```python
def refresh_chat():
    chat_container.clear()
    for msg in chat_history:
        ui.chat_message(
            msg['text'],
            name=msg['sender'],
            sent=(msg['sender'] == 'User'),
        )
```

* First we clear old content.
* Then we loop over `chat_history` and draw each message as a NiceGUI **chat bubble**.
* `sent=True` puts the bubble to the right (user side).

---

### d) Input row (like ChatGPT bottom area)

```python
with ui.row().classes('w-full max-w-3xl mt-3 items-center'):
    user_input = ui.input(
        placeholder='Type your message...'
    ).classes('w-full').props('type=textarea autogrow')

    send_button = ui.button('Send')
```

* `user_input` is where the user types text.
* `send_button` is the ‚ÄúSend‚Äù button.
* `type=textarea autogrow` lets the input grow in height if message is long.

---

### e) Sending message

```python
async def handle_send():
    text = (user_input.value or '').strip()
    if not text:
        ui.notify('Please type something.')
        return

    # Add user message
    chat_history.append({'sender': 'User', 'text': text})
    user_input.value = ''
    refresh_chat()
```

* Reads the text, trims spaces.
* If empty ‚Üí shows a small notification.
* If not empty ‚Üí adds to `chat_history` and refreshes.

Then:

```python
    thinking = ui.spinner(size='md').classes('mt-2')
    ui.update()

    reply = fake_bot_reply(text)

    thinking.delete()
    chat_history.append({'sender': 'Bot', 'text': reply})
    refresh_chat()
```

* Shows a small **spinner** to simulate ‚Äúbot is thinking‚Ä¶‚Äù.
* Calls `fake_bot_reply()` to get the answer.
* Removes the spinner and adds the bot reply to `chat_history`.
* Calls `refresh_chat()` again.

---

### f) Clicking and pressing Enter

```python
send_button.on('click', lambda e: ui.run_javascript('', handle_send()))
```

* When the button is clicked, it runs `handle_send()`.

```python
@user_input.on('keydown.enter')
async def _enter_key(event):
    await handle_send()
```

* When you press Enter in the input box, it also sends the message.
* So behavior feels like a chat app.

---

### g) Welcome message

```python
chat_history.append({'sender': 'Bot', 'text': 'Hi, I am your demo chatbot. How can I help you today?'})
refresh_chat()
```

* When the page opens, user sees a greeting from the bot.

---

## 3. How to Run and Test

1. Install NiceGUI (if not already):

```bash
pip install nicegui
```

2. Save the code as:

```text
chatbot_app.py
```

3. Run:

```bash
python chatbot_app.py
```

4. Open your browser:

```text
http://localhost:8080
```

5. Try:

   * Type a message and press **Enter** or click **Send**.
   * Watch the **chat bubbles** appear.
   * See the spinner appear briefly while the bot ‚Äúthinks.‚Äù

---

## 4. Next Steps ‚Äì Turning This into a Real ChatGPT-like App

Right now the bot is ‚Äúfake‚Äù. To make it real:

1. **Connect to your FastAPI backend**

   * Replace `fake_bot_reply()` with an async function that:

     * calls your FastAPI endpoint
     * waits for the response
     * returns the answer text

2. **Add conversation context**

   * Instead of only sending the last message,
   * Send the full `chat_history` (or last N messages) to the backend.

3. **Add roles / system prompt**

   * Add a dropdown like:

     * ‚ÄúFriendly teacher‚Äù
     * ‚ÄúDoctor assistant‚Äù
     * ‚ÄúTravel planner‚Äù
   * Pass that to the backend as the **system prompt**.

If you want, next lesson we can:

* Modify this UI to connect to your **existing diagnostic API**,
* Or add **multiple bots / personas** in a single screen.
Here‚Äôs Lesson 49 üòä

---

## Lesson 49: Building a General-Purpose Chatbot Interface (Like ChatGPT)

In this lesson, you‚Äôll build a **simple chatbot UI** that feels a bit like ChatGPT:

* A **chat area** that shows messages as bubbles
* A **text box** where the user types
* A **Send** button (and press Enter to send)
* A place where we can later plug in any **LLM / API**

We‚Äôll first use a **dummy reply function** (no real AI), so that you can clearly see how the UI works. Later you can replace that function with your **FastAPI + OpenAI** endpoint.

---

## 1. Full Example Code (Single File)

Save this as `chatbot_app.py`:

```python
from nicegui import ui

# ---------------------------
# In-memory chat storage
# ---------------------------

chat_history = []  # each item: {'sender': 'User' or 'Bot', 'text': '...'}


def fake_bot_reply(message: str) -> str:
    """Simple dummy reply to simulate a chatbot."""
    return f"You said: '{message}'. I'm a demo bot. In real app, I would call an AI model here."


# ---------------------------
# Main page
# ---------------------------

@ui.page('/')
def chatbot_page() -> None:

    # ---- Header like ChatGPT ----
    with ui.header().classes('bg-blue-700 text-white'):
        ui.label('My Chatbot').classes('text-xl font-bold')
        ui.space()
        ui.label('Demo UI with NiceGUI')

    # ---- Main layout: center column ----
    with ui.column().classes('w-full items-center p-4'):
        ui.label('Chat with the Bot').classes('text-lg font-bold mb-2')

        # Chat container: scrollable area for messages
        chat_container = ui.column().classes(
            'border rounded w-full max-w-3xl h-[70vh] p-3 overflow-y-auto bg-gray-50'
        )

        # function to redraw chat messages
        def refresh_chat():
            chat_container.clear()
            for msg in chat_history:
                ui.chat_message(
                    msg['text'],
                    name=msg['sender'],
                    sent=(msg['sender'] == 'User'),
                )

        # ---- Input area (bottom) ----
        with ui.row().classes('w-full max-w-3xl mt-3 items-center'):
            user_input = ui.input(
                placeholder='Type your message...'
            ).classes('w-full').props('type=textarea autogrow')

            send_button = ui.button('Send')

        # ---- Logic to send message ----
        async def handle_send():
            text = (user_input.value or '').strip()
            if not text:
                ui.notify('Please type something.')
                return

            # Add user message
            chat_history.append({'sender': 'User', 'text': text})
            user_input.value = ''
            refresh_chat()

            # Show a small "thinking" indicator
            thinking = ui.spinner(size='md').classes('mt-2')
            ui.update()

            # Get bot reply (dummy for now)
            reply = fake_bot_reply(text)

            # Remove spinner and add bot message
            thinking.delete()
            chat_history.append({'sender': 'Bot', 'text': reply})
            refresh_chat()

        # When button is clicked
        send_button.on('click', lambda e: ui.run_javascript('', handle_send()))

        # Allow pressing Enter (Ctrl+Enter to add new line idea simplified: basic enter sends)
        @user_input.on('keydown.enter')
        async def _enter_key(event):
            # Prevent line break and send
            await handle_send()

        # Initial welcome message
        chat_history.append({'sender': 'Bot', 'text': 'Hi, I am your demo chatbot. How can I help you today?'})
        refresh_chat()


# ---------------------------
# Run the app
# ---------------------------

ui.run(title='Chatbot Demo')
```

---

## 2. Understanding the Code (Step by Step)

Think of this app like chatting with a friend on WhatsApp:

* **Messages** go into a list (`chat_history`).
* We **redraw** the chat area each time a new message comes.

### a) `chat_history` and `fake_bot_reply`

```python
chat_history = []
```

* This is just a Python list.
* Every time someone chats, we add a small dictionary:

  * `{'sender': 'User', 'text': 'Hello'}`
  * `{'sender': 'Bot', 'text': 'Hi there'}`

```python
def fake_bot_reply(message: str) -> str:
    return f"You said: '{message}'. I'm a demo bot..."
```

* This is only a **placeholder**.
* Later, you can replace this with a real call to:

  * FastAPI endpoint
  * OpenAI, DeepSeek, etc.

---

### b) Header

```python
with ui.header().classes('bg-blue-700 text-white'):
    ui.label('My Chatbot').classes('text-xl font-bold')
    ui.space()
    ui.label('Demo UI with NiceGUI')
```

* This creates a bar at the top, like an app title bar.

---

### c) Chat container

```python
chat_container = ui.column().classes(
    'border rounded w-full max-w-3xl h-[70vh] p-3 overflow-y-auto bg-gray-50'
)
```

* A vertical stack (`column`) that:

  * Has border
  * Has fixed height
  * Can scroll (`overflow-y-auto`)
* This is where we show all the **chat bubbles**.

```python
def refresh_chat():
    chat_container.clear()
    for msg in chat_history:
        ui.chat_message(
            msg['text'],
            name=msg['sender'],
            sent=(msg['sender'] == 'User'),
        )
```

* First we clear old content.
* Then we loop over `chat_history` and draw each message as a NiceGUI **chat bubble**.
* `sent=True` puts the bubble to the right (user side).

---

### d) Input row (like ChatGPT bottom area)

```python
with ui.row().classes('w-full max-w-3xl mt-3 items-center'):
    user_input = ui.input(
        placeholder='Type your message...'
    ).classes('w-full').props('type=textarea autogrow')

    send_button = ui.button('Send')
```

* `user_input` is where the user types text.
* `send_button` is the ‚ÄúSend‚Äù button.
* `type=textarea autogrow` lets the input grow in height if message is long.

---

### e) Sending message

```python
async def handle_send():
    text = (user_input.value or '').strip()
    if not text:
        ui.notify('Please type something.')
        return

    # Add user message
    chat_history.append({'sender': 'User', 'text': text})
    user_input.value = ''
    refresh_chat()
```

* Reads the text, trims spaces.
* If empty ‚Üí shows a small notification.
* If not empty ‚Üí adds to `chat_history` and refreshes.

Then:

```python
    thinking = ui.spinner(size='md').classes('mt-2')
    ui.update()

    reply = fake_bot_reply(text)

    thinking.delete()
    chat_history.append({'sender': 'Bot', 'text': reply})
    refresh_chat()
```

* Shows a small **spinner** to simulate ‚Äúbot is thinking‚Ä¶‚Äù.
* Calls `fake_bot_reply()` to get the answer.
* Removes the spinner and adds the bot reply to `chat_history`.
* Calls `refresh_chat()` again.

---

### f) Clicking and pressing Enter

```python
send_button.on('click', lambda e: ui.run_javascript('', handle_send()))
```

* When the button is clicked, it runs `handle_send()`.

```python
@user_input.on('keydown.enter')
async def _enter_key(event):
    await handle_send()
```

* When you press Enter in the input box, it also sends the message.
* So behavior feels like a chat app.

---

### g) Welcome message

```python
chat_history.append({'sender': 'Bot', 'text': 'Hi, I am your demo chatbot. How can I help you today?'})
refresh_chat()
```

* When the page opens, user sees a greeting from the bot.

---

## 3. How to Run and Test

1. Install NiceGUI (if not already):

```bash
pip install nicegui
```

2. Save the code as:

```text
chatbot_app.py
```

3. Run:

```bash
python chatbot_app.py
```

4. Open your browser:

```text
http://localhost:8080
```

5. Try:

   * Type a message and press **Enter** or click **Send**.
   * Watch the **chat bubbles** appear.
   * See the spinner appear briefly while the bot ‚Äúthinks.‚Äù

---

## 4. Next Steps ‚Äì Turning This into a Real ChatGPT-like App

Right now the bot is ‚Äúfake‚Äù. To make it real:

1. **Connect to your FastAPI backend**

   * Replace `fake_bot_reply()` with an async function that:

     * calls your FastAPI endpoint
     * waits for the response
     * returns the answer text

2. **Add conversation context**

   * Instead of only sending the last message,
   * Send the full `chat_history` (or last N messages) to the backend.

3. **Add roles / system prompt**

   * Add a dropdown like:

     * ‚ÄúFriendly teacher‚Äù
     * ‚ÄúDoctor assistant‚Äù
     * ‚ÄúTravel planner‚Äù
   * Pass that to the backend as the **system prompt**.



