# Lesson 33 — Authentication & Login Page

**(Letting only the right people enter your app)**

---

### 1. What you will learn

In this lesson, you will learn how to create a **login page** with NiceGUI.

You will be able to:

* Ask the user for a **username** and **password**
* Check if they are correct
* Remember that the user is “logged in” for this browser
* Show different content based on login status

This idea is called **authentication** – in simple words:

> “Are you really who you say you are?”

---

### 2. Simple real-life example

Think of entering a **clinic**:

* At the door, the guard checks your **ID card**
* If the ID is valid → you are allowed inside
* If not → you are stopped

A login page does the same:

* The login form is the guard
* Username and password are the ID card
* Only valid users are allowed into the main app

We’ll build a very simple version of this.

---

### 3. Step-by-step plan

1. Create a small “user database” in code (just a Python dictionary)
2. Build a login form with:

   * Username input
   * Password input
   * Login button
3. When the button is clicked:

   * Check if username & password are correct
   * If correct → mark user as logged in in session storage
   * If wrong → show an error message
4. Show:

   * “Not logged in” message before login
   * “Logged in as …” message after login

---

### 4. Code Example — Simple Login Page

Save this as **`main.py`**.

```python
from nicegui import ui, app

# A simple "database" of users (for demo only)
USERS = {
    'doctor1': 'pass123',
    'admin': 'admin321',
}

def init_session():
    """Make sure login info exists in user storage."""
    app.storage.user.setdefault('logged_in', False)
    app.storage.user.setdefault('username', '')

def update_status():
    """Update the status label based on login state."""
    if app.storage.user['logged_in']:
        status_label.set_text(f"Logged in as: {app.storage.user['username']}")
    else:
        status_label.set_text("Not logged in")

def handle_login():
    """Check username and password and log the user in if correct."""
    username = username_input.value.strip()
    password = password_input.value

    # Check if username exists and password matches
    if username in USERS and USERS[username] == password:
        app.storage.user['logged_in'] = True
        app.storage.user['username'] = username
        update_status()
        ui.notify('Login successful!', type='positive')
        password_input.value = ''  # clear password
    else:
        ui.notify('Invalid username or password', type='negative')

def handle_logout():
    """Log the user out."""
    app.storage.user['logged_in'] = False
    app.storage.user['username'] = ''
    update_status()
    ui.notify('Logged out', type='warning')


# ---------- UI LAYOUT ----------

init_session()

ui.label('Simple Login Page')

status_label = ui.label()   # will be filled by update_status()

with ui.card():
    ui.label('Please log in')

    username_input = ui.input('Username')
    password_input = ui.input('Password', password=True, password_toggle_button=True)

    with ui.row():
        ui.button('Login', on_click=handle_login)
        ui.button('Logout', on_click=handle_logout)

ui.separator()

protected_label = ui.label(
    'This is your clinic dashboard area (visible whether logged in or not in this simple demo).'
)

update_status()

ui.run()
```

---

### 5. Explanation in simple words

#### Fake user database

```python
USERS = {
    'doctor1': 'pass123',
    'admin': 'admin321',
}
```

* This is just a Python dictionary.
* Keys are usernames (`doctor1`, `admin`).
* Values are passwords (`pass123`, `admin321`).
* In a **real app**, this would come from a **database**.

---

#### Session storage

```python
app.storage.user.setdefault('logged_in', False)
app.storage.user.setdefault('username', '')
```

* `app.storage.user` is like a **small personal box** of memory for each browser.
* `logged_in`: remembers whether this user is logged in or not.
* `username`: remembers who is logged in.

Each browser (each person) gets a **separate** storage box.

---

#### Status label

```python
def update_status():
    if app.storage.user['logged_in']:
        status_label.set_text(f"Logged in as: {app.storage.user['username']}")
    else:
        status_label.set_text("Not logged in")
```

* This updates the text at the top.
* Shows either:

  * “Not logged in”
  * or “Logged in as: doctor1”

---

#### Login handling

```python
def handle_login():
    username = username_input.value.strip()
    password = password_input.value

    if username in USERS and USERS[username] == password:
        app.storage.user['logged_in'] = True
        app.storage.user['username'] = username
        update_status()
        ui.notify('Login successful!', type='positive')
        password_input.value = ''
    else:
        ui.notify('Invalid username or password', type='negative')
```

* Reads what the user typed in the username and password fields.
* Checks if:

  * the username exists in `USERS`
  * AND the password matches.
* If correct:

  * sets `logged_in = True`
  * stores the username
  * updates the status text
  * shows a green success popup (`ui.notify`)
* If wrong:

  * shows a red error popup.

---

#### Logout handling

```python
def handle_logout():
    app.storage.user['logged_in'] = False
    app.storage.user['username'] = ''
    update_status()
    ui.notify('Logged out', type='warning')
```

* Clears login info.
* Updates label to “Not logged in”.
* Shows a logout message.

---

### 6. How to run and test

1. Install NiceGUI (if not already):

   ```bash
   pip install nicegui
   ```

2. Save the code as **`main.py`**.

3. Run the app:

   ```bash
   python main.py
   ```

4. Open your browser and go to:

   ```
   http://localhost:8080
   ```

5. Test login:

   * Try username: `doctor1` and password: `pass123`
   * Click **Login**
   * You should see:

     * notification: “Login successful!”
     * status: “Logged in as: doctor1”

6. Try wrong password:

   * Use `doctor1` + `wrongpass`
   * See error notification.

7. Click **Logout** to clear the session and go back to “Not logged in”.

---

### 7. Tips & Best Practices

**Tip 1: Never store real passwords like this in production**

For real systems:

* Use a **database**
* Store only **hashed** passwords (not plain text)
* Use a proper authentication library or framework

But for learning and prototyping, this simple dictionary is fine.

---

**Tip 2: Hide content for non-logged users**

In a real app, for important pages (like **patient list**, **doctor dashboard**, etc.), you can:

* Check `app.storage.user['logged_in']`
* If `False`, show a message: “Please log in first.”
* If `True`, show the real content.



