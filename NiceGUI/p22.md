# **Lesson 22: Auto-fill Forms Using AI**

*(Based on the ‚Äúfill-gap agent‚Äù idea)*

### **What you will learn**

In this lesson, you will learn how a form can **automatically fill missing details** using AI.

This is very useful in medical cases:

* The doctor enters a few details
* AI fills the remaining fields (e.g., summary, suspected diagnosis, observations)
* The doctor checks and adjusts the auto-filled information

Think of it like having a junior assistant who completes the form for you.

---

## üè• **Real-life example**

Imagine a doctor types:

> ‚ÄúPatient has fever for 3 days with body ache.‚Äù

The AI can auto-fill:

* Possible cause ‚Üí ‚ÄúViral fever‚Äù
* Suggested tests ‚Üí ‚ÄúCBC, Dengue NS1‚Äù
* Important questions to ask ‚Üí ‚ÄúAny rash? Any travel history?‚Äù
* Summary ‚Üí Clean one-paragraph summary

This reduces typing and speeds up diagnosis.

---

# -----------------------------------

# **PART 1 ‚Äî How the system works**

The system has **three parts**:

1. **NiceGUI form** ‚Üí doctor types the main symptoms
2. **FastAPI + AI API** ‚Üí sends symptoms to an AI model
3. **AI returns structured fields** ‚Üí form auto-fills remaining details

We will build a simple version here.

---

# -----------------------------------

# **PART 2 ‚Äî FastAPI Backend (AI Fill-Gap Agent)**

### Backend steps:

* Receive basic symptom text
* Send it to AI (OpenAI or any model)
* Ask AI to return structured JSON
* Send JSON back to NiceGUI
* NiceGUI fills the missing fields automatically

---

# **backend.py**

```python
from fastapi import FastAPI
from pydantic import BaseModel
from openai import OpenAI

app = FastAPI()
client = OpenAI()

class SymptomInput(BaseModel):
    symptoms: str

@app.post('/fill-gaps')
def fill_gaps(data: SymptomInput):

    prompt = f"""
    You are a medical assistant.
    Read the symptom text below and fill the missing fields.
    
    Symptoms: {data.symptoms}

    Return a JSON with:
    - summary
    - possible_diagnosis
    - suggested_tests
    - follow_up_questions
    """

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": prompt}]
    )

    ai_output = response.choices[0].message.content
    return {"ai_data": ai_output}
```

---

# **Simple explanation**

* The backend receives symptom text
* Sends it to the AI with instructions
* AI generates structured JSON
* Backend gives this back to the frontend

This AI behaves like your **fill-gap agent** ‚Äî completes missing fields.

---

# -----------------------------------

# **PART 3 ‚Äî NiceGUI Frontend**

The NiceGUI form will:

1. Let the doctor type symptoms
2. Send symptoms to `/fill-gaps`
3. Receive AI-generated fields
4. Automatically fill form fields (summary, diagnosis, tests, etc.)

---

# **frontend.py**

```python
from nicegui import ui
import requests
import json

ui.label('AI Auto-Fill Medical Form').classes('text-h5')

symptoms = ui.textarea('Enter symptoms')
summary = ui.textarea('Summary (AI will fill)')
diagnosis = ui.input('Possible Diagnosis')
tests = ui.textarea('Suggested Tests')
questions = ui.textarea('Follow-up Questions')

def auto_fill():
    if not symptoms.value:
        ui.notify('Please enter symptoms first', color='red')
        return

    response = requests.post(
        'http://localhost:8000/fill-gaps',
        json={"symptoms": symptoms.value}
    )

    if response.status_code != 200:
        ui.notify('AI Error', color='red')
        return

    # AI output is a JSON string
    data = response.json()
    ai_data = json.loads(data['ai_data'])

    # Fill the fields
    summary.value = ai_data.get('summary', '')
    diagnosis.value = ai_data.get('possible_diagnosis', '')
    tests.value = ai_data.get('suggested_tests', '')
    questions.value = ai_data.get('follow_up_questions', '')

    ui.notify('Auto-filled by AI!', color='green')

ui.button('Auto-Fill Using AI', on_click=auto_fill)

ui.run()
```

---

# -----------------------------------

# **Line-by-line explanation (simple words)**

### **symptoms = ui.textarea()**

Doctor types free text.

### **summary, diagnosis, tests, questions**

These will be filled by AI.

### **auto_fill()**

Runs when you click the button:

1. Sends typed symptoms to FastAPI
2. FastAPI sends them to the AI
3. AI returns JSON
4. JSON is inserted into form fields
5. Doctor sees the completed form

### **ui.run()**

Starts the app.

---

# -----------------------------------

# **How to run**

### Step 1 ‚Äî Start backend

```
uvicorn backend:app --reload
```

### Step 2 ‚Äî Start frontend

```
python frontend.py
```

Open in browser (usually automatically):
**[http://localhost:8080](http://localhost:8080)**

Type symptoms ‚Üí click **Auto-Fill Using AI** ‚Üí fields are filled.

---

# -----------------------------------

# **Tips & Best Practices**

### ‚≠ê Tip 1

Always ask AI to return **strict JSON**, not free text.
This makes form filling automatic.

### ‚≠ê Tip 2

Keep AI responses short.
Doctors prefer quick, clear summaries.

### ‚≠ê Tip 3

Keep doctor ‚Äúin control‚Äù:
AI fills, but doctor edits.

---

