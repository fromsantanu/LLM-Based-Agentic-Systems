# **Lesson 20: File Upload Forms**

*(Example: Uploading lab reports)*

### **What you will learn**

In this lesson, you will learn how to build a form in NiceGUI that lets users **upload files** ‚Äî such as lab reports, X-ray images, or prescriptions.

You will also learn how to send the uploaded file to a **FastAPI backend**, which can save it on the server.

---

## üè• **Real-life example**

Think of a real clinic visit.
The doctor may ask you:

‚ÄúDo you have your blood test report? Please upload it.‚Äù

Online systems do this with a **file upload form**.

NiceGUI makes it very easy ‚Äî like attaching a file in WhatsApp or Gmail.

---

# -----------------------------------

# **PART 1 ‚Äî FastAPI Backend**

# -----------------------------------

We create one simple API endpoint:

### **POST /upload-report**

It will:

* Accept a file
* Save it into a folder called `reports/`
* Return a success message

---

# **backend.py**

```python
from fastapi import FastAPI, UploadFile, File
import os

app = FastAPI()

# Create folder if it doesn't exist
os.makedirs('reports', exist_ok=True)

@app.post('/upload-report')
async def upload_report(file: UploadFile = File(...)):
    # Save uploaded file
    file_location = f"reports/{file.filename}"

    with open(file_location, "wb") as f:
        f.write(await file.read())

    return {"message": "File uploaded successfully", "filename": file.filename}
```

---

# **Simple explanation**

* `UploadFile` lets FastAPI receive uploaded files
* We save the file inside a folder named `reports`
* `await file.read()` reads the file content
* Returning JSON lets the frontend show a proper message

This backend acts like the **clinic records room** where files are stored.

---

# -----------------------------------

# **PART 2 ‚Äî NiceGUI Frontend**

# -----------------------------------

We will:

1. Create a file upload component
2. When the user selects a file, we store it temporarily
3. When they click **Upload**, we send it to the FastAPI backend

---

# **frontend.py**

```python
from nicegui import ui
import requests

ui.label('Upload Lab Report').classes('text-h5')

selected_file = None   # to store the uploaded file temporarily

# -----------------------------------
# Choose file
# -----------------------------------
def on_upload(e):
    global selected_file
    selected_file = e.content
    ui.notify(f"Selected: {e.name}")

upload_component = ui.upload(
    label='Choose a file',
    on_upload=on_upload,
    auto_upload=False
).props('accept=".pdf, .jpg, .png, .jpeg"')   # allowed file types


# -----------------------------------
# Send to backend
# -----------------------------------
def send_to_backend():
    if not selected_file:
        ui.notify("Please choose a file first", color='red')
        return

    # Prepare a file tuple like (filename, bytes, mime-type)
    files = {
        "file": (upload_component.value[0].name, selected_file, "application/octet-stream")
    }

    response = requests.post(
        "http://localhost:8000/upload-report",
        files=files
    )

    if response.status_code == 200:
        ui.notify("File uploaded successfully!", color='green')
    else:
        ui.notify("Upload failed", color='red')

ui.button('Upload', on_click=send_to_backend)

ui.run()
```

---

# **Line-by-line explanation**

### **`ui.upload()`**

Shows a file picker ‚Äî like "Browse File" on websites.

### **`on_upload(e)`**

* Triggered when a file is selected
* `e.content` contains the file‚Äôs bytes
* `e.name` is the filename

We store the file temporarily in `selected_file`.

### **`send_to_backend()`**

* Checks if the user selected a file
* Prepares a request with `files=...`
* Sends it to FastAPI `/upload-report`
* Shows success or failure message

### **`ui.run()`**

Starts the NiceGUI app.

---

# **How to run**

### **Step 1 ‚Äî Start backend**

```
uvicorn backend:app --reload
```

### **Step 2 ‚Äî Start frontend**

```
python frontend.py
```

Your browser opens at:

**[http://localhost:8080](http://localhost:8080)**

Choose a file ‚Üí click **Upload** ‚Üí file goes to the backend and gets saved in `reports/`.

---

# **Tips & Best Practices**

### ‚≠ê Tip 1

Allow only necessary file types (PDF, images).
This prevents users from uploading harmful files.

### ‚≠ê Tip 2

Store files in separate folders by **patient ID** (e.g., `reports/1234/report1.pdf`).
This keeps files organized and easy to find.

---
