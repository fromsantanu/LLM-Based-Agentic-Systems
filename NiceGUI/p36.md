# **Lesson 36 – Using LangChain Tools & Agents from a NiceGUI UI**

In this lesson, you will learn how to:

* Create a very simple NiceGUI page
* Let the user type something
* Send that text to a **LangChain agent/tool**
* Show the agent’s response on the screen

Think of this like a shop counter again:

* **User** → walks to the counter and asks something
* **NiceGUI UI** → takes the question
* **LangChain agent** → goes inside a storeroom, uses tools, checks information, and returns with an answer
* **UI** → shows the answer to the user

We will keep everything beginner-friendly and very small.

---

# **1. What we are going to build**

A small app:

* A text area for a question
* A button: **“Run Agent”**
* A label that shows the agent’s reply

The LangChain agent will be set up to use:

* A model (OpenAI)
* A simple tool (like a calculator)

This keeps the example easy to understand.

---

# **2. Install what you need**

In your virtual environment:

```bash
pip install nicegui langchain openai langchain-openai
```

Set your OpenAI API key:

Windows:

```bash
setx OPENAI_API_KEY "your_api_key"
```

Linux/macOS:

```bash
export OPENAI_API_KEY="your_api_key"
```

---

# **3. Overview of what the agent will do**

We will create an agent that can use a **calculator tool**.

Example questions the agent can solve:

* “What is 27 * 13?”
* “If I earn 50,000 per month, how much in 12 months?”
* “What is the square root of 144?”

You can later replace this with your own tools (like medical analysis, database lookups, file search, etc.).

---

# **4. LangChain Agent Setup (very simple)**

We will use:

* **OpenAI model**
* **built-in calculator tool** from LangChain
* **AgentExecutor** so the agent can decide when to use the tool

This gives you the basic skeleton.

---

# **5. Full Example Code (copy-paste and run)**

Save as `main.py`:

```python
import os
from nicegui import ui

from langchain_openai import ChatOpenAI
from langchain.agents import initialize_agent, Tool
from langchain.tools import tool
from langchain.agents import AgentType

# -------------------------
# 1. Create a simple tool
# -------------------------

@tool
def calculator_tool(expression: str) -> str:
    """A simple calculator that evaluates math expressions."""
    try:
        result = eval(expression)
        return str(result)
    except Exception:
        return "Error: Unable to calculate."


# -------------------------
# 2. Create the agent
# -------------------------

llm = ChatOpenAI(
    api_key=os.getenv("OPENAI_API_KEY"),
    model="gpt-4.1-mini",
    temperature=0
)

tools = [
    Tool(
        name="calculator",
        func=calculator_tool,
        description="Useful for solving math expressions"
    )
]

agent = initialize_agent(
    tools,
    llm,
    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
    verbose=False
)


# -------------------------
# 3. NiceGUI UI
# -------------------------

def run_agent():
    user_text = input_box.value

    if not user_text.strip():
        output_label.text = "Please type a question."
        return

    output_label.text = "Thinking..."

    try:
        reply = agent.run(user_text)
        output_label.text = reply
    except Exception as e:
        output_label.text = f"Error: {str(e)}"


with ui.card():
    ui.label("LangChain Agent Inside NiceGUI")

    global input_box
    input_box = ui.textarea(
        label="Ask your question",
        placeholder="Example: what is 27 * 13 ?"
    ).props('autogrow')

    ui.button("Run Agent", on_click=run_agent)

    global output_label
    output_label = ui.label("Agent response will appear here.")

ui.run()
```

---

# **6. Line-by-Line Explanation (Simple Language)**

### **Tool creation**

```python
@tool
def calculator_tool(expression: str) -> str:
```

* This creates a tiny calculator
* The agent can call it when needed

```python
result = eval(expression)
```

* It evaluates the math text
* Example: `"25*3"` → `75`

---

### **Agent setup**

```python
llm = ChatOpenAI(...)
```

* This is the OpenAI model the agent will use

```python
tools = [Tool(...)]
```

* We give the agent a list of tools
* Here only one: calculator

```python
agent = initialize_agent(...)
```

* This makes the agent smart enough to:

  * read the question
  * guess if calculator is needed
  * call the tool automatically
  * return the final answer

---

### **UI**

```python
input_box = ui.textarea(...)
```

* User types a question here

```python
ui.button("Run Agent", on_click=run_agent)
```

* Runs the agent

```python
output_label = ui.label(...)
```

* Where the agent’s answer appears

---

### **The main function**

```python
def run_agent():
    user_text = input_box.value
```

* Reads the text typed by the user

```python
reply = agent.run(user_text)
```

* Sends it to LangChain agent
* Agent decides whether to use the calculator
* Returns final answer

```python
output_label.text = reply
```

* Show the result on the screen

---

# **7. How to Run and Test**

1. Install packages:

   ```bash
   pip install nicegui langchain openai langchain-openai
   ```

2. Save code as `main.py`

3. Run:

   ```bash
   python main.py
   ```

4. Open the browser link (usually `http://127.0.0.1:8080`)

5. Type:

   **“What is 25 × 16?”**

6. Press **Run Agent**

You should see the correct calculation from the agent.

---

# **8. Tips & Best Practices**

### **Tip 1 — Start with very small tools**

Begin with tools like:

* calculator
* dictionary lookup
* simple database read

Later you can add:

* medical reasoning
* patient history lookup
* workflow triggers
* n8n integrations

### **Tip 2 — Keep the UI simple first**

One text box and one button is enough for beginners.
Once it works, add:

* chat history
* loading animation
* multiple agent modes

---

