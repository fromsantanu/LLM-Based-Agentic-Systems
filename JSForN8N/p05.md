# 🌐 5. **APIs and HTTP Requests (Optional but Powerful)**

When working in **n8n**, many workflows interact with external systems — to send data, trigger actions, or retrieve information. Understanding how to work with APIs gives your automations *real power*.

---

## 🔍 **Basics of REST APIs**

REST (Representational State Transfer) defines a set of standard operations that web services use to communicate:

| Method     | Purpose              | Example                 |
| ---------- | -------------------- | ----------------------- |
| **GET**    | Retrieve data        | Get patient records     |
| **POST**   | Send new data        | Submit a new report     |
| **PUT**    | Update existing data | Update a record         |
| **DELETE** | Remove data          | Delete a file or record |

💡 **Tip:** Always check the API documentation for required headers, body format, and authentication methods.

---

## ⚙️ **Using `fetch()` in Function Nodes**

n8n runs JavaScript inside a Node.js environment.
Some environments support `fetch()` natively — allowing you to call external APIs directly.

**Example:**

```js
const res = await fetch("https://api.example.com/patients", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify($json)
});

return [{ json: await res.json() }];
```

Here:

* `$json` = current item’s data
* `await res.json()` = parses the API’s JSON response

---

## 🧾 **Adding Headers and Query Parameters**

Headers carry metadata like authentication tokens or content types.
Query parameters allow filtering or specifying criteria in GET requests.

**Example (GET request with query):**

```js
const url = "https://api.example.com/patients?age_gt=40&status=active";
const res = await fetch(url, {
  headers: { "Authorization": "Bearer " + $env("API_TOKEN") }
});
return [{ json: await res.json() }];
```

---

## ⚡ **Handling JSON Responses**

APIs often respond with JSON.
You can directly parse and pass this data into the next node.

**Example:**

```js
const data = await res.json();
return data.map(item => ({ json: item }));
```

This converts each element from the API response into a separate n8n item.

---

## 🚨 **Error Handling with `try...catch`**

APIs may fail due to invalid data, missing auth tokens, or server errors.
Use `try...catch` to prevent workflow crashes.

**Example:**

```js
try {
  const res = await fetch("https://api.example.com/patients", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify($json)
  });

  if (!res.ok) throw new Error(`API error: ${res.status}`);

  return [{ json: await res.json() }];

} catch (err) {
  return [{ json: { error: err.message } }];
}
```

---

## 💡 **Pro Tip**

* Use **HTTP Request** node for simpler API calls — it has built-in authentication, query builder, and error handling.
* Use **Function / Code** nodes when you need dynamic API URLs, headers, or complex logic.

---

✅ **Mini Exercise**

1. Create a test API at [https://reqres.in](https://reqres.in)
2. In an n8n Function node, send a POST request to create a user with name and job fields.
3. Parse and return the JSON response.
4. Try adding error handling for 404 or 500 errors.

---
