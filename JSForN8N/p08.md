# ⚙️ 8. **Working with Multiple Items**

In n8n, many nodes (like Airtable, Google Sheets, or APIs) return **multiple items** — usually an **array of JSON objects**.
You’ll often need to **loop through, modify, or filter** these items inside a Function node.

---

## 🧩 What Are “Items” in n8n?

Each incoming record (like a row, API object, or message) is wrapped as:

```js
{
  json: {
    field1: value1,
    field2: value2
  }
}
```

When multiple items arrive, n8n provides them as an **array**:

```js
[
  { json: { name: "Alice", score: 82 } },
  { json: { name: "Bob", score: 45 } },
  { json: { name: "Charlie", score: 91 } }
]
```

---

## 🧠 Accessing and Transforming Multiple Items

Use the built-in variable `items`, which contains **all incoming items**.

Example: Add a new field `status` based on `score`:

```js
return items.map(item => {
  const score = item.json.score;
  const status = score >= 60 ? "Pass" : "Fail";
  return { json: { ...item.json, status } };
});
```

💡 **Tip:**
`map()` transforms items,
`filter()` removes items,
`forEach()` performs side effects (like logging).

---

## 🔍 Filtering Items

Keep only the ones matching a condition:

```js
return items.filter(item => item.json.status === "Pass");
```

You can also combine conditions:

```js
return items.filter(item => item.json.age > 18 && item.json.city === "Delhi");
```

---

#### 🔄 Combining / Splitting Data

**Combine multiple arrays:**

```js
const combined = [...items1, ...items2];
return combined;
```

**Split a list into smaller batches:**

```js
const batchSize = 10;
let batches = [];
for (let i = 0; i < items.length; i += batchSize) {
  batches.push(items.slice(i, i + batchSize));
}
return batches.flat();
```

---

## 🧱 Flattening Nested Data

If an API returns nested arrays:

```js
{ json: { orders: [ {id:1}, {id:2} ] } }
```

You can flatten it like:

```js
let result = [];
for (const item of items) {
  for (const order of item.json.orders) {
    result.push({ json: order });
  }
}
return result;
```

---

## 🧾 Example – Grade Categorizer

Input:

```json
[
  {"name": "Asha", "score": 95},
  {"name": "Ravi", "score": 70},
  {"name": "Priya", "score": 40}
]
```

Code:

```js
return items.map(item => {
  const s = item.json.score;
  let grade;
  if (s >= 90) grade = "A";
  else if (s >= 70) grade = "B";
  else grade = "C";
  return { json: { ...item.json, grade } };
});
```

Output:

```json
[
  {"name": "Asha", "score": 95, "grade": "A"},
  {"name": "Ravi", "score": 70, "grade": "B"},
  {"name": "Priya", "score": 40, "grade": "C"}
]
```

---

## 🧩 Mini-Exercise

✅ **Task:**
You have items with `{ name, age }`.
Write Function node code to:

1. Keep only those with `age > 30`.
2. Add a field `category = "Senior"`.

💡 *Hint:* use `filter()` then `map()` together.

---
