# ⚙️ 3. **Arrays and Data Transformation**

Most workflows in **n8n** process *lists of items* — for example, a list of users from a database, rows from Google Sheets, or records from an API response.
Mastering **arrays** is therefore *absolutely essential* to transform and filter your data effectively inside Function or Code nodes.

---

### 🧱 **Creating and Accessing Arrays**

Arrays are ordered lists of values:

```js
const fruits = ["apple", "banana", "cherry"];
```

Access elements by index (starting from 0):

```js
console.log(fruits[0]); // "apple"
console.log(fruits[2]); // "cherry"
```

You can also modify or add new elements:

```js
fruits[1] = "mango";    // Replace "banana" with "mango"
fruits.push("orange");  // Add at the end
fruits.unshift("kiwi"); // Add at the beginning
```

---

### 🔧 **Common Array Methods**

These are the array functions you’ll use daily in n8n:

#### 🧩 `map()`

Transforms each item in an array and returns a *new* array.

```js
const numbers = [1, 2, 3];
const doubled = numbers.map(num => num * 2);
console.log(doubled); // [2, 4, 6]
```

#### 🔍 `filter()`

Keeps only items that satisfy a condition.

```js
const items = [
  { json: { priority: "high" } },
  { json: { priority: "low" } }
];

return items.filter(item => item.json.priority === "high");
```

#### 🧮 `reduce()`

Combines all items into a single result (sum, count, etc.).

```js
const values = [10, 20, 30];
const total = values.reduce((acc, v) => acc + v, 0);
console.log(total); // 60
```

#### 🔁 `forEach()`

Executes a function for each item (does not return anything).

```js
fruits.forEach(fruit => console.log(fruit));
```

#### 🔎 `find()`

Returns the *first* element matching a condition.

```js
const result = items.find(item => item.json.priority === "low");
```

#### ✅ `some()` / `every()`

Checks if *any* or *all* elements satisfy a condition.

```js
const hasHigh = items.some(item => item.json.priority === "high");
const allHigh = items.every(item => item.json.priority === "high");
```

---

### 🔄 **Sorting, Slicing, Concatenating**

#### 🔢 `sort()`

Sorts an array *in place*.

```js
const numbers = [3, 1, 2];
numbers.sort(); // [1, 2, 3]
```

With custom logic:

```js
numbers.sort((a, b) => b - a); // Descending
```

#### ✂️ `slice()`

Returns a *portion* of an array (non-destructive).

```js
const subset = fruits.slice(1, 3); // elements 1 and 2
```

#### ➕ `concat()`

Combines two arrays.

```js
const allFruits = fruits.concat(["grape", "melon"]);
```

---

### 🔁 **Looping Through Arrays of JSON Items**

In n8n, `items` is typically an **array of objects** like this:

```js
[
  { json: { id: 1, name: "Alice", priority: "high" } },
  { json: { id: 2, name: "Bob", priority: "low" } }
]
```

You can loop through and modify them:

```js
return items.map(item => {
  item.json.status = item.json.priority === "high" ? "urgent" : "normal";
  return item;
});
```

---

### 💡 **Real n8n Example**

Filter all records where `priority` is `"high"` and add a timestamp:

```js
return items
  .filter(item => item.json.priority === "high")
  .map(item => ({
    json: {
      ...item.json,
      processedAt: new Date().toISOString()
    }
  }));
```

---

### 🧠 **Mini Practice**

1. Create an array of numbers and return only even ones.
2. Sort an array of task objects by `dueDate`.
3. From an array of `{ name, age }`, return names of people over 18.
4. Count how many tasks have `"completed": true` using `reduce()`.

---

