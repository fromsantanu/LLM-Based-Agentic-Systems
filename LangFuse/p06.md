# Chapter 6: Analytics & Metrics

Once you’ve instrumented your agents and workflows, the next crucial step is measuring their **performance, cost, and reliability**. LangFuse provides the analytics layer that helps you understand how well your system is functioning and where optimizations are needed.

---

## 6.1 Understanding Latency, Token Usage, and Cost Monitoring

* **Latency**
  Measure the response times of LLM calls, tool invocations, and agent transitions.

  * Helps identify bottlenecks (e.g., a slow external API or a long-running chain).
  * Use LangFuse spans to capture the duration of each step.

* **Token Usage**
  Track tokens consumed for prompts and completions.

  * Essential for optimizing prompts and managing costs.
  * Aggregate by agent, user session, or workflow to spot heavy consumers.

* **Cost Monitoring**
  Combine token usage with pricing models to estimate real-time expenses.

  * LangFuse allows attaching metadata such as `$ per 1k tokens`.
  * You can set up cost thresholds and alerts for unexpected spikes.

---

## 6.2 Aggregating Metrics per Agent or Workflow

Analytics become more actionable when broken down by **entity**:

* **Per-Agent Metrics**

  * Latency distribution for each agent (diagnostic agent, queue manager, etc.).
  * Average tokens and cost per query handled.
  * Error rates or retries required.

* **Workflow-Level Metrics**

  * Total completion rate for a multi-step flow (e.g., triage → diagnosis → treatment plan).
  * Average “time to resolution.”
  * Points of failure where users drop off.

LangFuse lets you group traces and spans with labels like `agent_name`, `workflow_id`, or `tenant_id` for detailed filtering.

---

## 6.3 Measuring Agent Success Rates

Beyond raw metrics, you need to assess **success**:

* **Task Completion**
  Define what counts as a “successful outcome” (e.g., diagnostic agent produces valid JSON schema).

  * Mark traces with a success flag via `@traceable(success=True)` or custom metadata.

* **Handoffs**
  For hierarchical agents, track how often tasks are successfully delegated downstream.

  * Example: Queue Manager → Diagnostic Agent → Treatment Planner.
  * Measure whether each handoff produces a valid output or fails.

* **Custom KPIs**
  Integrate evaluation functions (e.g., string similarity, factual correctness, structured schema validation) into LangFuse scoring.

---

## 6.4 Setting Up Dashboards and Alerts

* **Dashboards**

  * LangFuse provides a built-in dashboard to visualize latency, cost, and success rates.
  * Use filters (e.g., “last 24 hours,” “by workflow type”) to slice metrics.
  * Connect with external BI tools (Grafana, Metabase, Superset) via the LangFuse API.

* **Alerts**

  * Configure thresholds:

    * Latency > 5 seconds
    * Cost > $100/day
    * Success rate < 80%
  * Send alerts to Slack, email, or monitoring pipelines.

By closing the loop between **observability → analytics → alerting**, you ensure your agentic system stays performant and cost-efficient in production.

---

✅ **Key Takeaway**: Analytics in LangFuse go beyond simple logging. They empower you to measure the **business and operational impact** of each agent, detect failures early, and continuously improve your workflows.

---
