# **Chapter 9. Multi-Agent Systems**

## What are Multi-Agent Systems?

A **multi-agent system (MAS)** consists of multiple autonomous agents that work together to solve complex tasks. Unlike a single agent that relies on tool use and memory, a multi-agent system distributes responsibilities among specialized agents. Each agent may have different roles, knowledge, or tools, but collectively, they form a cooperative system.

Examples:

* Healthcare: A diagnostic agent, treatment planner, and patient monitoring agent.
* Research: A literature search agent, data analysis agent, and summary/reporting agent.
* Business: A forecasting agent, sales insights agent, and recommendation agent.

The main advantages are **parallelization, specialization, scalability, and robustness.**

---

## Designing Hierarchical Agents (Supervisor → Worker)

One common pattern in multi-agent systems is **hierarchical design**:

* **Supervisor Agent**:
  Oversees the task, delegates subtasks, and ensures progress. It doesn’t perform deep work but manages workflow.

* **Worker Agents**:
  Each is specialized in a narrow area and executes subtasks.

### Example:

* Supervisor: *“Write a report on global inflation trends.”*
* Worker 1: *Research Agent → Collects recent data from trusted sources.*
* Worker 2: *Data Analyst Agent → Cleans and analyzes the data.*
* Worker 3: *Report Writer Agent → Writes a structured report using Supervisor’s instructions and Analyst’s outputs.*

This allows **divide-and-conquer problem solving** while maintaining oversight.

---

## Communication Between Agents

Agents need to exchange information efficiently. LangChain provides multiple mechanisms to achieve this:

1. **Shared Memory / Message Queue**

   * Agents write outputs into a shared memory buffer or vector store.
   * Other agents read from it.

2. **Direct Prompt Passing**

   * Supervisor sends structured prompts to workers.
   * Workers respond with structured outputs (JSON, text blocks).

3. **Tool-mediated Communication**

   * Agents can use tools (e.g., file storage, databases) to pass results indirectly.

### Example Flow:

1. Research Agent outputs `"papers.json"`.
2. Analyst Agent loads `"papers.json"` and produces `"analysis.csv"`.
3. Writer Agent takes `"analysis.csv"` and produces `"report.docx"`.

This ensures smooth data handover without confusion.

---

## Case Study: Research Assistant + Data Analyst + Report Writer

Let’s walk through a **multi-agent pipeline**:

**Task:** Create a research-backed report on “The Impact of Remote Work on Productivity.”

1. **Research Assistant Agent**

   * Searches academic papers, reports, and statistics.
   * Extracts structured notes (title, author, findings).
   * Saves them into a vector database for retrieval.

2. **Data Analyst Agent**

   * Processes datasets (survey results, productivity metrics).
   * Runs descriptive and inferential statistics.
   * Outputs charts, tables, and key insights.

3. **Report Writer Agent**

   * Reads both research notes and analysis outputs.
   * Writes a coherent report with introduction, methodology, findings, and conclusion.
   * Ensures clarity and logical flow.

4. **Supervisor Agent**

   * Breaks down tasks, monitors progress, checks for completeness.
   * Handles missing outputs (e.g., asks Research Agent to refine sources).

This structure enables **scalable and modular research workflows.**

---

## Managing Conflicts and Coordination

In multi-agent systems, conflicts may arise when:

* Two agents provide contradictory outputs.
* A worker produces incomplete or invalid data.
* Agents loop without convergence.

### Strategies for Conflict Resolution:

1. **Supervisor Arbitration**

   * Supervisor compares conflicting outputs and decides which one to keep.

2. **Voting or Consensus**

   * Multiple worker agents provide results, and the best/common answer is selected.

3. **Validation Tools**

   * Use external evaluators (e.g., regex, schema checkers, factuality scorers) to verify worker outputs.

4. **Fallback to Human-in-the-Loop**

   * For high-stakes tasks (medical, legal, financial), human oversight resolves final conflicts.

---

✅ **Key Takeaways:**

* Multi-agent systems enable collaboration, specialization, and scaling.
* Hierarchical design ensures clarity: **Supervisor → Workers**.
* Communication can be direct, memory-based, or tool-mediated.
* Real-world workflows (e.g., Research → Analysis → Writing) are natural fits.
* Conflict resolution and coordination are essential for reliability.

---

